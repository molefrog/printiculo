{"version":3,"file":"public\\javascripts\\app.js","sources":["app/vendor/jsmpeg.js","app/vendor/bootstrap/bootstrap.min.js","app/application.coffee","app/collections/shotCollection.coffee","app/collections/stationCollection.coffee","app/controllers/auth/authController.coffee","app/controllers/auth/loginController.coffee","app/controllers/auth/stationAuthController.coffee","app/controllers/base/baseController.coffee","app/controllers/shotsController.coffee","app/controllers/staticController.coffee","app/controllers/stationsController.coffee","app/initialize.coffee","app/models/shot.coffee","app/models/station.coffee","app/routes.coffee","app/storage.coffee","app/utils/analytics/yandexMetrika.js","app/views/about/aboutView.coffee","app/views/about/aboutView_.jade","app/views/auth/loginView.coffee","app/views/auth/loginView_.jade","app/views/base/base.coffee","app/views/base/collectionView.coffee","app/views/shot/grid/item/shotGridItemView.coffee","app/views/shot/grid/item/shotGridItemView_.jade","app/views/shot/grid/shotGridView.coffee","app/views/shot/grid/shotGridView_.jade","app/views/shot/show/shotView.coffee","app/views/shot/show/shotView_.jade","app/views/site/header/headerView.coffee","app/views/site/header/headerView_.jade","app/views/site/siteView.coffee","app/views/site/siteView_.jade","app/views/station/create/stationCreateView.coffee","app/views/station/create/stationCreateView_.jade","app/views/station/edit/stationEditView.coffee","app/views/station/edit/stationEditView_.jade","app/views/station/list/stationListItemView.coffee","app/views/station/list/stationListItemView_.jade","app/views/station/list/stationListView.coffee","app/views/station/list/stationListView_.jade","app/views/station/rename/stationRenameView.coffee","app/views/station/rename/stationRenameView_.jade","app/views/station/show/stationView.coffee","app/views/station/show/stationView_.jade"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;CC/rEA;AACA;AACA;AACA;AACA;AACA;;ACLA;GAAA;kSAAA;;AAAA,GAAU,IAAV,EAAU;;AAGV,CAHA,EAGuB,GAAjB,CAAN;CACE;;;;;CAAA;;CAAA,EAAO,EAAP,IAAO;CAGL;CAAC,CAAkB,CAAnB,CAAmB,KAAC,EAApB;CACE,GAAG,EAAH;CACE,EAAe,CAAf,GAAO,CAAP;OADF;CADiB,QAIjB;CAJF,IAAmB;CAHrB,EAAO;;CAAP;;CADyC,MAAO;;;;ACHlD;GAAA;kSAAA;;AAAA,GAAO,CAAP,GAAO;;AAEP,CAFA,EAEuB,GAAjB,CAAN;CACE;;;;;CAAA;;CAAA,EAAQ,CAAR;;CAAA,EACA,SADA;;CAAA,EAGY,MAAZ;CACE;CAAC,CAAK,CAAN,CAAS,GAAT,EACM,EADN;CAEM,YAAD;CAFL,EAGM,CAHN,CACM,IAEA;CAPR,EAGY;;CAHZ;;CAD6C,MAAO;;;;ACFtD;GAAA;kSAAA;;AAAA,GAAU,IAAV,SAAU;;AAEV,CAFA,EAEuB,GAAjB,CAAN;CACE;;;;;CAAA;;CAAA,MAA4B,EAA5B,QAAU;;CAAV,EAEQ,EAAR,EAFA;;CAAA,EAGA,YAHA;;CAAA;;CAD+C,MAAO;;;;ACFxD;GAAA;kSAAA;;AAAA,GAAU,IAAV,EAAU;;AA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","sourcesContent":["(function(window){ \"use strict\";\r\n\r\n// jsmpeg by Dominic Szablewski - phoboslab.org, github.com/phoboslab\r\n//\r\n// Consider this to be under MIT license. It's largely based an an Open Source\r\n// Decoder for Java under GPL, while I looked at another Decoder from Nokia \r\n// (under no particular license?) for certain aspects.\r\n// I'm not sure if this work is \"derivative\" enough to have a different license\r\n// but then again, who still cares about MPEG1?\r\n//\r\n// Based on \"Java MPEG-1 Video Decoder and Player\" by Korandi Zoltan:\r\n// http://sourceforge.net/projects/javampeg1video/\r\n//\r\n// Inspired by \"MPEG Decoder in Java ME\" by Nokia:\r\n// http://www.developer.nokia.com/Community/Wiki/MPEG_decoder_in_Java_ME\r\n\r\n\r\nvar requestAnimFrame = (function(){\r\n\treturn window.requestAnimationFrame ||\r\n\t\twindow.webkitRequestAnimationFrame ||\r\n\t\twindow.mozRequestAnimationFrame ||\r\n\t\tfunction( callback ){\r\n\t\t\twindow.setTimeout(callback, 1000 / 60);\r\n\t\t};\r\n})();\r\n\t\t\r\nvar jsmpeg = window.jsmpeg = function( url, opts ) {\r\n\topts = opts || {};\r\n\tthis.benchmark = !!opts.benchmark;\r\n\tthis.canvas = opts.canvas || document.createElement('canvas');\r\n\tthis.autoplay = !!opts.autoplay;\r\n\tthis.loop = !!opts.loop;\r\n\tthis.externalLoadCallback = opts.onload || null;\r\n\tthis.externalDecodeCallback = opts.ondecodeframe || null;\r\n\tthis.externalFinishedCallback = opts.onfinished || null;\r\n\tthis.bwFilter = opts.bwFilter || false;\r\n\r\n\tthis.customIntraQuantMatrix = new Uint8Array(64);\r\n\tthis.customNonIntraQuantMatrix = new Uint8Array(64);\r\n\tthis.blockData = new Int32Array(64);\r\n\r\n\tthis.canvasContext = this.canvas.getContext('2d');\r\n\r\n\tif( url instanceof WebSocket ) {\r\n\t\tthis.client = url;\r\n\t\tthis.client.onopen = this.initSocketClient.bind(this);\r\n\t} \r\n\telse {\r\n\t\tthis.load(url);\r\n\t}\r\n};\r\n\r\n\r\n\r\n// ----------------------------------------------------------------------------\r\n// Streaming over WebSockets\r\n\r\njsmpeg.prototype.waitForIntraFrame = true;\r\njsmpeg.prototype.socketBufferSize = 512 * 1024; // 512kb each\r\njsmpeg.prototype.onlostconnection = null;\r\n\r\njsmpeg.prototype.initSocketClient = function( client ) {\r\n\tthis.buffer = new BitReader(new ArrayBuffer(this.socketBufferSize));\r\n\r\n\tthis.nextPictureBuffer = new BitReader(new ArrayBuffer(this.socketBufferSize));\r\n\tthis.nextPictureBuffer.writePos = 0;\r\n\tthis.nextPictureBuffer.chunkBegin = 0;\r\n\tthis.nextPictureBuffer.lastWriteBeforeWrap = 0;\r\n\r\n\tthis.client.binaryType = 'arraybuffer';\r\n\tthis.client.onmessage = this.receiveSocketMessage.bind(this);\r\n};\r\n\r\njsmpeg.prototype.decodeSocketHeader = function( data ) {\r\n\t// Custom header sent to all newly connected clients when streaming\r\n\t// over websockets:\r\n\t// struct { char magic[4] = \"jsmp\"; unsigned short width, height; };\r\n\tif( \r\n\t\tdata[0] == SOCKET_MAGIC_BYTES.charCodeAt(0) && \r\n\t\tdata[1] == SOCKET_MAGIC_BYTES.charCodeAt(1) && \r\n\t\tdata[2] == SOCKET_MAGIC_BYTES.charCodeAt(2) && \r\n\t\tdata[3] == SOCKET_MAGIC_BYTES.charCodeAt(3)\r\n\t) {\r\n\t\tthis.width = (data[4] * 256 + data[5]);\r\n\t\tthis.height = (data[6] * 256 + data[7]);\r\n\t\tthis.initBuffers();\r\n\t}\r\n};\r\n\r\njsmpeg.prototype.receiveSocketMessage = function( event ) {\r\n\tvar messageData = new Uint8Array(event.data);\r\n\r\n\tif( !this.sequenceStarted ) {\r\n\t\tthis.decodeSocketHeader(messageData);\r\n\t}\r\n\r\n\tvar current = this.buffer;\r\n\tvar next = this.nextPictureBuffer;\r\n\r\n\tif( next.writePos + messageData.length > next.length ) {\r\n\t\tnext.lastWriteBeforeWrap = next.writePos;\r\n\t\tnext.writePos = 0;\r\n\t\tnext.index = 0;\r\n\t}\r\n\t\r\n\tnext.bytes.set( messageData, next.writePos );\r\n\tnext.writePos += messageData.length;\r\n\r\n\tvar startCode = 0;\r\n\twhile( true ) {\r\n\t\tstartCode = next.findNextMPEGStartCode();\r\n\t\tif( \r\n\t\t\tstartCode == BitReader.NOT_FOUND ||\r\n\t\t\t((next.index >> 3) > next.writePos)\r\n\t\t) {\r\n\t\t\t// We reached the end with no picture found yet; move back a few bytes\r\n\t\t\t// in case we are at the beginning of a start code and exit.\r\n\t\t\tnext.index = Math.max((next.writePos-3), 0) << 3;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\telse if( startCode == START_PICTURE ) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\t// If we are still here, we found the next picture start code!\r\n\r\n\t\r\n\t// Skip picture decoding until we find the first intra frame?\r\n\tif( this.waitForIntraFrame ) {\r\n\t\tnext.advance(10); // skip temporalReference\r\n\t\tif( next.getBits(3) == PICTURE_TYPE_I ) {\r\n\t\t\tthis.waitForIntraFrame = false;\r\n\t\t\tnext.chunkBegin = (next.index-13) >> 3;\r\n\t\t}\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Last picture hasn't been decoded yet? Decode now but skip output\r\n\t// before scheduling the next one\r\n\tif( !this.currentPictureDecoded ) {\r\n\t\tthis.decodePicture(DECODE_SKIP_OUTPUT);\r\n\t}\r\n\r\n\t\r\n\t// Copy the picture chunk over to 'this.buffer' and schedule decoding.\r\n\tvar chunkEnd = ((next.index) >> 3);\r\n\r\n\tif( chunkEnd > next.chunkBegin ) {\r\n\t\t// Just copy the current picture chunk\r\n\t\tcurrent.bytes.set( next.bytes.subarray(next.chunkBegin, chunkEnd) );\r\n\t\tcurrent.writePos = chunkEnd - next.chunkBegin;\r\n\t}\r\n\telse {\r\n\t\t// We wrapped the nextPictureBuffer around, so we have to copy the last part\r\n\t\t// till the end, as well as from 0 to the current writePos\r\n\t\tcurrent.bytes.set( next.bytes.subarray(next.chunkBegin, next.lastWriteBeforeWrap) );\r\n\t\tvar written = next.lastWriteBeforeWrap - next.chunkBegin;\r\n\t\tcurrent.bytes.set( next.bytes.subarray(0, chunkEnd), written );\r\n\t\tcurrent.writePos = chunkEnd + written;\r\n\t}\r\n\r\n\tcurrent.index = 0;\r\n\tnext.chunkBegin = chunkEnd;\r\n\r\n\t// Decode!\r\n\tthis.currentPictureDecoded = false;\r\n\trequestAnimFrame( this.scheduleDecoding.bind(this), this.canvas );\r\n};\r\n\r\njsmpeg.prototype.scheduleDecoding = function() {\r\n\tthis.decodePicture();\r\n\tthis.currentPictureDecoded = true;\r\n};\r\n\r\n\r\n\r\n// ----------------------------------------------------------------------------\r\n// Recording from WebSockets\r\n\r\njsmpeg.prototype.isRecording = false;\r\njsmpeg.prototype.recorderWaitForIntraFrame = false;\r\njsmpeg.prototype.recordedFrames = 0;\r\njsmpeg.prototype.recordedSize = 0;\r\njsmpeg.prototype.didStartRecordingCallback = null;\r\n\r\njsmpeg.prototype.recordBuffers = [];\r\n\r\njsmpeg.prototype.canRecord = function(){\r\n\treturn (this.client && this.client.readyState == this.client.OPEN);\r\n};\r\n\r\njsmpeg.prototype.startRecording = function(callback) {\r\n\tif( !this.canRecord() ) {\r\n\t\treturn;\r\n\t}\r\n\t\r\n\t// Discard old buffers and set for recording\r\n\tthis.discardRecordBuffers();\r\n\tthis.isRecording = true;\r\n\tthis.recorderWaitForIntraFrame = true;\r\n\tthis.didStartRecordingCallback = callback || null;\r\n\r\n\tthis.recordedFrames = 0;\r\n\tthis.recordedSize = 0;\r\n\t\r\n\t// Fudge a simple Sequence Header for the MPEG file\r\n\t\r\n\t// 3 bytes width & height, 12 bits each\r\n\tvar wh1 = (this.width >> 4),\r\n\t\twh2 = ((this.width & 0xf) << 4) | (this.height >> 8),\r\n\t\twh3 = (this.height & 0xff);\r\n\t\r\n\tthis.recordBuffers.push(new Uint8Array([\r\n\t\t0x00, 0x00, 0x01, 0xb3, // Sequence Start Code\r\n\t\twh1, wh2, wh3, // Width & height\r\n\t\t0x13, // aspect ratio & framerate\r\n\t\t0xff, 0xff, 0xe1, 0x58, // Meh. Bitrate and other boring stuff\r\n\t\t0x00, 0x00, 0x01, 0xb8, 0x00, 0x08, 0x00, // GOP\r\n\t\t0x00, 0x00, 0x00, 0x01, 0x00 // First Picture Start Code\r\n\t]));\r\n};\r\n\r\njsmpeg.prototype.recordFrameFromCurrentBuffer = function() {\r\n\tif( !this.isRecording ) { return; }\r\n\t\r\n\tif( this.recorderWaitForIntraFrame ) {\r\n\t\t// Not an intra frame? Exit.\r\n\t\tif( this.pictureCodingType != PICTURE_TYPE_I ) { return; }\r\n\t\r\n\t\t// Start recording!\r\n\t\tthis.recorderWaitForIntraFrame = false;\r\n\t\tif( this.didStartRecordingCallback ) {\r\n\t\t\tthis.didStartRecordingCallback( this );\r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.recordedFrames++;\r\n\tthis.recordedSize += this.buffer.writePos;\r\n\t\r\n\t// Copy the actual subrange for the current picture into a new Buffer\r\n\tthis.recordBuffers.push(new Uint8Array(this.buffer.bytes.subarray(0, this.buffer.writePos)));\r\n};\r\n\r\njsmpeg.prototype.discardRecordBuffers = function() {\r\n\tthis.recordBuffers = [];\r\n\tthis.recordedFrames = 0;\r\n};\r\n\r\njsmpeg.prototype.stopRecording = function() {\r\n\tvar blob = new Blob(this.recordBuffers, {type: 'video/mpeg'});\r\n\tthis.discardRecordBuffers();\r\n\tthis.isRecording = false;\r\n\treturn blob;\r\n};\r\n\r\n\r\n\r\n// ----------------------------------------------------------------------------\r\n// Loading via Ajax\r\n\t\r\njsmpeg.prototype.load = function( url ) {\r\n\tthis.url = url;\r\n\r\n\tvar request = new XMLHttpRequest();\r\n\tvar that = this;\r\n\trequest.onreadystatechange = function() {\t\t\r\n\t\tif( request.readyState == request.DONE && request.status == 200 ) {\r\n\t\t\tthat.loadCallback(request.response);\r\n\t\t}\r\n\t};\r\n\trequest.onprogress = this.updateLoader.bind(this);\r\n\r\n\trequest.open('GET', url);\r\n\trequest.responseType = \"arraybuffer\";\r\n\trequest.send();\r\n};\r\n\r\njsmpeg.prototype.updateLoader = function( ev ) {\r\n\tvar \r\n\t\tp = ev.loaded / ev.total,\r\n\t\tw = this.canvas.width,\r\n\t\th = this.canvas.height,\r\n\t\tctx = this.canvasContext;\r\n\r\n\tctx.fillStyle = '#222';\r\n\tctx.fillRect(0, 0, w, h);\r\n\tctx.fillStyle = '#fff';\r\n\tctx.fillRect(0, h - h*p, w, h*p);\r\n};\r\n\t\r\njsmpeg.prototype.loadCallback = function(file) {\r\n\tvar time = Date.now();\r\n\tthis.buffer = new BitReader(file);\r\n\t\r\n\tthis.findStartCode(START_SEQUENCE);\r\n\tthis.firstSequenceHeader = this.buffer.index;\r\n\tthis.decodeSequenceHeader();\r\n\r\n\t// Load the first frame\r\n\tthis.nextFrame();\r\n\t\r\n\tif( this.autoplay ) {\r\n\t\tthis.play();\r\n\t}\r\n\r\n\tif( this.externalLoadCallback ) {\r\n\t\tthis.externalLoadCallback(this);\r\n\t}\r\n};\r\n\r\njsmpeg.prototype.play = function(file) {\r\n\tif( this.playing ) { return; }\r\n\tthis.targetTime = Date.now();\r\n\tthis.playing = true;\r\n\tthis.scheduleNextFrame();\r\n};\r\n\r\njsmpeg.prototype.pause = function(file) {\r\n\tthis.playing = false;\r\n};\r\n\r\njsmpeg.prototype.stop = function(file) {\r\n\tif( this.buffer ) {\r\n\t\tthis.buffer.index = this.firstSequenceHeader;\r\n\t}\r\n\tthis.playing = false;\r\n\tif( this.client ) {\r\n\t\tthis.client.close();\r\n\t\tthis.client = null;\r\n\t}\r\n};\r\n\r\n\r\n\r\n// ----------------------------------------------------------------------------\r\n// Utilities\r\n\r\njsmpeg.prototype.readCode = function(codeTable) {\r\n\tvar state = 0;\r\n\tdo {\r\n\t\tstate = codeTable[state + this.buffer.getBits(1)];\r\n\t} while( state >= 0 && codeTable[state] != 0 );\r\n\treturn codeTable[state+2];\r\n};\r\n\r\njsmpeg.prototype.findStartCode = function( code ) {\r\n\tvar current = 0;\r\n\twhile( true ) {\r\n\t\tcurrent = this.buffer.findNextMPEGStartCode();\r\n\t\tif( current == code || current == BitReader.NOT_FOUND ) {\r\n\t\t\treturn current;\r\n\t\t}\r\n\t}\r\n\treturn BitReader.NOT_FOUND;\r\n};\r\n\r\njsmpeg.prototype.fillArray = function(a, value) {\r\n\tfor( var i = 0, length = a.length; i < length; i++ ) {\r\n\t\ta[i] = value;\r\n\t}\r\n};\r\n\r\n\r\n\r\n// ----------------------------------------------------------------------------\r\n// Sequence Layer\r\n\r\njsmpeg.prototype.pictureRate = 30;\r\njsmpeg.prototype.lateTime = 0;\r\njsmpeg.prototype.firstSequenceHeader = 0;\r\njsmpeg.prototype.targetTime = 0;\r\n\r\njsmpeg.prototype.nextFrame = function() {\r\n\tif( !this.buffer ) { return; }\r\n\twhile(true) {\r\n\t\tvar code = this.buffer.findNextMPEGStartCode();\r\n\t\t\r\n\t\tif( code == START_SEQUENCE ) {\r\n\t\t\tthis.decodeSequenceHeader();\r\n\t\t}\r\n\t\telse if( code == START_PICTURE ) {\r\n\t\t\tif( this.playing ) {\r\n\t\t\t\tthis.scheduleNextFrame();\r\n\t\t\t}\r\n\t\t\tthis.decodePicture();\r\n\t\t\treturn this.canvas;\r\n\t\t}\r\n\t\telse if( code == BitReader.NOT_FOUND ) {\r\n\t\t\tthis.stop(); // Jump back to the beginning\r\n\r\n\t\t\tif( this.this.externalFinishedCallback ) {\r\n\t\t\t\tthis.externalFinishedCallback(this);\r\n\t\t\t}\r\n\r\n\t\t\t// Only loop if we found a sequence header\r\n\t\t\tif( this.loop && this.sequenceStarted ) {\r\n\t\t\t\tthis.play();\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// ignore (GROUP, USER_DATA, EXTENSION, SLICES...)\r\n\t\t}\r\n\t}\r\n};\r\n\r\njsmpeg.prototype.scheduleNextFrame = function() {\r\n\tthis.lateTime = Date.now() - this.targetTime;\r\n\tvar wait = Math.max(0, (1000/this.pictureRate) - this.lateTime);\r\n\tthis.targetTime = Date.now() + wait;\r\n\r\n\tif( this.benchmark ) {\r\n\t\tvar now = Date.now();\r\n\t\tif(!this.benchframe) {\r\n\t\t\tthis.benchstart = now;\r\n\t\t\tthis.benchframe = 0;\r\n\t\t}\r\n\t\tthis.benchframe++;\r\n\t\tvar timepassed = now - this.benchstart;\r\n\t\tif( this.benchframe >= 100 ) {\r\n\t\t\tthis.benchfps = (this.benchframe / timepassed) * 1000;\r\n\t\t\tif( console ) {\r\n\t\t\t\tconsole.log(\"frames per second: \" + this.benchfps);\r\n\t\t\t}\r\n\t\t\tthis.benchframe = null;\r\n\t\t}\r\n\t\tsetTimeout( this.nextFrame.bind(this), 0);\r\n\t}\r\n\telse if( wait < 18) {\r\n\t\tthis.scheduleAnimation();\r\n\t}\r\n\telse {\r\n\t\tsetTimeout( this.scheduleAnimation.bind(this), wait );\r\n\t}\r\n};\r\n\r\njsmpeg.prototype.scheduleAnimation = function() {\r\n\trequestAnimFrame( this.nextFrame.bind(this), this.canvas );\r\n};\r\n\t\r\njsmpeg.prototype.decodeSequenceHeader = function() {\r\n\tthis.width = this.buffer.getBits(12);\r\n\tthis.height = this.buffer.getBits(12);\r\n\tthis.buffer.advance(4); // skip pixel aspect ratio\r\n\tthis.pictureRate = PICTURE_RATE[this.buffer.getBits(4)];\r\n\tthis.buffer.advance(18 + 1 + 10 + 1); // skip bitRate, marker, bufferSize and constrained bit\r\n\r\n\tthis.initBuffers();\r\n\r\n\tif( this.buffer.getBits(1) ) { // load custom intra quant matrix?\r\n\t\tfor( var i = 0; i < 64; i++ ) {\r\n\t\t\tthis.customIntraQuantMatrix[ZIG_ZAG[i]] = this.buffer.getBits(8);\r\n\t\t}\r\n\t\tthis.intraQuantMatrix = this.customIntraQuantMatrix;\r\n\t}\r\n\t\r\n\tif( this.buffer.getBits(1) ) { // load custom non intra quant matrix?\r\n\t\tfor( var i = 0; i < 64; i++ ) {\r\n\t\t\tthis.customNonIntraQuantMatrix[ZIG_ZAG[i]] = this.buffer.getBits(8);\r\n\t\t}\r\n\t\tthis.nonIntraQuantMatrix = this.customNonIntraQuantMatrix;\r\n\t}\r\n};\r\n\r\njsmpeg.prototype.initBuffers = function() {\t\r\n\tthis.intraQuantMatrix = DEFAULT_INTRA_QUANT_MATRIX;\r\n\tthis.nonIntraQuantMatrix = DEFAULT_NON_INTRA_QUANT_MATRIX;\r\n\t\r\n\tthis.mbWidth = (this.width + 15) >> 4;\r\n\tthis.mbHeight = (this.height + 15) >> 4;\r\n\tthis.mbSize = this.mbWidth * this.mbHeight;\r\n\t\r\n\tthis.codedWidth = this.mbWidth << 4;\r\n\tthis.codedHeight = this.mbHeight << 4;\r\n\tthis.codedSize = this.codedWidth * this.codedHeight;\r\n\t\r\n\tthis.halfWidth = this.mbWidth << 3;\r\n\tthis.halfHeight = this.mbHeight << 3;\r\n\tthis.quarterSize = this.codedSize >> 2;\r\n\t\r\n\t// Sequence already started? Don't allocate buffers again\r\n\tif( this.sequenceStarted ) { return; }\r\n\tthis.sequenceStarted = true;\r\n\t\r\n\t\r\n\t// Manually clamp values when writing macroblocks for shitty browsers\r\n\t// that don't support Uint8ClampedArray\r\n\tvar MaybeClampedUint8Array = window.Uint8ClampedArray || window.Uint8Array;\r\n\tif( !window.Uint8ClampedArray ) {\r\n\t\tthis.copyBlockToDestination = this.copyBlockToDestinationClamp;\r\n\t\tthis.addBlockToDestination = this.addBlockToDestinationClamp;\r\n\t}\r\n\t\r\n\t// Allocated buffers and resize the canvas\r\n\tthis.currentY = new MaybeClampedUint8Array(this.codedSize);\r\n\tthis.currentY32 = new Uint32Array(this.currentY.buffer);\r\n\r\n\tthis.currentCr = new MaybeClampedUint8Array(this.codedSize >> 2);\r\n\tthis.currentCr32 = new Uint32Array(this.currentCr.buffer);\r\n\r\n\tthis.currentCb = new MaybeClampedUint8Array(this.codedSize >> 2);\r\n\tthis.currentCb32 = new Uint32Array(this.currentCb.buffer);\r\n\t\r\n\r\n\tthis.forwardY = new MaybeClampedUint8Array(this.codedSize);\r\n\tthis.forwardY32 = new Uint32Array(this.forwardY.buffer);\r\n\r\n\tthis.forwardCr = new MaybeClampedUint8Array(this.codedSize >> 2);\r\n\tthis.forwardCr32 = new Uint32Array(this.forwardCr.buffer);\r\n\r\n\tthis.forwardCb = new MaybeClampedUint8Array(this.codedSize >> 2);\r\n\tthis.forwardCb32 = new Uint32Array(this.forwardCb.buffer);\r\n\t\r\n\tthis.canvas.width = this.width;\r\n\tthis.canvas.height = this.height;\r\n\t\r\n\tthis.currentRGBA = this.canvasContext.getImageData(0, 0, this.width, this.height);\r\n\r\n\tif( this.bwFilter ) {\r\n\t\t// This fails in IE10; don't use the bwFilter if you need to support it.\r\n\t\tthis.currentRGBA32 = new Uint32Array( this.currentRGBA.data.buffer );\r\n\t}\r\n\tthis.fillArray(this.currentRGBA.data, 255);\r\n};\r\n\r\n\r\n\r\n\r\n// ----------------------------------------------------------------------------\r\n// Picture Layer\r\n\r\njsmpeg.prototype.currentY = null;\r\njsmpeg.prototype.currentCr = null;\r\njsmpeg.prototype.currentCb = null;\r\n\r\njsmpeg.prototype.currentRGBA = null;\r\n\r\njsmpeg.prototype.pictureCodingType = 0;\r\n\r\n// Buffers for motion compensation\r\njsmpeg.prototype.forwardY = null;\r\njsmpeg.prototype.forwardCr = null;\r\njsmpeg.prototype.forwardCb = null;\r\n\r\njsmpeg.prototype.fullPelForward = false;\r\njsmpeg.prototype.forwardFCode = 0;\r\njsmpeg.prototype.forwardRSize = 0;\r\njsmpeg.prototype.forwardF = 0;\r\n\r\n\r\njsmpeg.prototype.decodePicture = function(skipOutput) {\r\n\tthis.buffer.advance(10); // skip temporalReference\r\n\tthis.pictureCodingType = this.buffer.getBits(3);\r\n\tthis.buffer.advance(16); // skip vbv_delay\r\n\t\r\n\t// Skip B and D frames or unknown coding type\r\n\tif( this.pictureCodingType <= 0 || this.pictureCodingType >= PICTURE_TYPE_B ) {\r\n\t\treturn;\r\n\t}\r\n\t\r\n\t// full_pel_forward, forward_f_code\r\n\tif( this.pictureCodingType == PICTURE_TYPE_P ) {\r\n\t\tthis.fullPelForward = this.buffer.getBits(1);\r\n\t\tthis.forwardFCode = this.buffer.getBits(3);\r\n\t\tif( this.forwardFCode == 0 ) {\r\n\t\t\t// Ignore picture with zero forward_f_code\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.forwardRSize = this.forwardFCode - 1;\r\n\t\tthis.forwardF = 1 << this.forwardRSize;\r\n\t}\r\n\t\r\n\tvar code = 0;\r\n\tdo {\r\n\t\tcode = this.buffer.findNextMPEGStartCode();\r\n\t} while( code == START_EXTENSION || code == START_USER_DATA );\r\n\t\r\n\t\r\n\twhile( code >= START_SLICE_FIRST && code <= START_SLICE_LAST ) {\r\n\t\tthis.decodeSlice( (code & 0x000000FF) );\r\n\t\tcode = this.buffer.findNextMPEGStartCode();\r\n\t}\r\n\t\r\n\t// We found the next start code; rewind 32bits and let the main loop handle it.\r\n\tthis.buffer.rewind(32);\r\n\r\n\t// Record this frame, if the recorder wants it\r\n\tthis.recordFrameFromCurrentBuffer();\r\n\t\r\n\t\r\n\tif( skipOutput != DECODE_SKIP_OUTPUT ) {\r\n\t\tif( this.bwFilter ) {\r\n\t\t\tthis.YToRGBA();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.YCbCrToRGBA();\t\r\n\t\t}\r\n\t\tthis.canvasContext.putImageData(this.currentRGBA, 0, 0);\r\n\r\n\t\tif(this.externalDecodeCallback) {\r\n\t\t\tthis.externalDecodeCallback(this, this.canvas);\r\n\t\t}\r\n\t}\r\n\t\r\n\t// If this is a reference picutre then rotate the prediction pointers\r\n\tif( this.pictureCodingType == PICTURE_TYPE_I || this.pictureCodingType == PICTURE_TYPE_P ) {\r\n\t\tvar \r\n\t\t\ttmpY = this.forwardY,\r\n\t\t\ttmpY32 = this.forwardY32,\r\n\t\t\ttmpCr = this.forwardCr,\r\n\t\t\ttmpCr32 = this.forwardCr32,\r\n\t\t\ttmpCb = this.forwardCb,\r\n\t\t\ttmpCb32 = this.forwardCb32;\r\n\r\n\t\tthis.forwardY = this.currentY;\r\n\t\tthis.forwardY32 = this.currentY32;\r\n\t\tthis.forwardCr = this.currentCr;\r\n\t\tthis.forwardCr32 = this.currentCr32;\r\n\t\tthis.forwardCb = this.currentCb;\r\n\t\tthis.forwardCb32 = this.currentCb32;\r\n\r\n\t\tthis.currentY = tmpY;\r\n\t\tthis.currentY32 = tmpY32;\r\n\t\tthis.currentCr = tmpCr;\r\n\t\tthis.currentCr32 = tmpCr32;\r\n\t\tthis.currentCb = tmpCb;\r\n\t\tthis.currentCb32 = tmpCb32;\r\n\t}\r\n};\r\n\r\njsmpeg.prototype.YCbCrToRGBA = function() {\t\r\n\tvar pY = this.currentY;\r\n\tvar pCb = this.currentCb;\r\n\tvar pCr = this.currentCr;\r\n\tvar pRGBA = this.currentRGBA.data;\r\n\r\n\t// Chroma values are the same for each block of 4 pixels, so we proccess\r\n\t// 2 lines at a time, 2 neighboring pixels each.\r\n\t// I wish we could use 32bit writes to the RGBA buffer instead of writing\r\n\t// each byte separately, but we need the automatic clamping of the RGBA\r\n\t// buffer.\r\n\r\n\tvar yIndex1 = 0;\r\n\tvar yIndex2 = this.codedWidth;\r\n\tvar yNext2Lines = this.codedWidth + (this.codedWidth - this.width);\r\n\r\n\tvar cIndex = 0;\r\n\tvar cNextLine = this.halfWidth - (this.width >> 1);\r\n\r\n\tvar rgbaIndex1 = 0;\r\n\tvar rgbaIndex2 = this.width * 4;\r\n\tvar rgbaNext2Lines = this.width * 4;\r\n\t\r\n\tvar cols = this.width >> 1;\r\n\tvar rows = this.height >> 1;\r\n\r\n\tvar y, cb, cr, r, g, b;\r\n\r\n\tfor( var row = 0; row < rows; row++ ) {\r\n\t\tfor( var col = 0; col < cols; col++ ) {\r\n\t\t\tcb = pCb[cIndex];\r\n\t\t\tcr = pCr[cIndex];\r\n\t\t\tcIndex++;\r\n\t\t\t\r\n\t\t\tr = (cr + ((cr * 103) >> 8)) - 179;\r\n\t\t\tg = ((cb * 88) >> 8) - 44 + ((cr * 183) >> 8) - 91;\r\n\t\t\tb = (cb + ((cb * 198) >> 8)) - 227;\r\n\t\t\t\r\n\t\t\t// Line 1\r\n\t\t\ty = pY[yIndex1++];\r\n\t\t\tpRGBA[rgbaIndex1] = y + r;\r\n\t\t\tpRGBA[rgbaIndex1+1] = y - g;\r\n\t\t\tpRGBA[rgbaIndex1+2] = y + b;\r\n\t\t\trgbaIndex1 += 4;\r\n\t\t\t\r\n\t\t\ty = pY[yIndex1++];\r\n\t\t\tpRGBA[rgbaIndex1] = y + r;\r\n\t\t\tpRGBA[rgbaIndex1+1] = y - g;\r\n\t\t\tpRGBA[rgbaIndex1+2] = y + b;\r\n\t\t\trgbaIndex1 += 4;\r\n\t\t\t\r\n\t\t\t// Line 2\r\n\t\t\ty = pY[yIndex2++];\r\n\t\t\tpRGBA[rgbaIndex2] = y + r;\r\n\t\t\tpRGBA[rgbaIndex2+1] = y - g;\r\n\t\t\tpRGBA[rgbaIndex2+2] = y + b;\r\n\t\t\trgbaIndex2 += 4;\r\n\t\t\t\r\n\t\t\ty = pY[yIndex2++];\r\n\t\t\tpRGBA[rgbaIndex2] = y + r;\r\n\t\t\tpRGBA[rgbaIndex2+1] = y - g;\r\n\t\t\tpRGBA[rgbaIndex2+2] = y + b;\r\n\t\t\trgbaIndex2 += 4;\r\n\t\t}\r\n\t\t\r\n\t\tyIndex1 += yNext2Lines;\r\n\t\tyIndex2 += yNext2Lines;\r\n\t\trgbaIndex1 += rgbaNext2Lines;\r\n\t\trgbaIndex2 += rgbaNext2Lines;\r\n\t\tcIndex += cNextLine;\r\n\t}\r\n};\r\n\r\njsmpeg.prototype.YToRGBA = function() {\t\r\n\t// Luma only\r\n\tvar pY = this.currentY;\r\n\tvar pRGBA = this.currentRGBA32;\r\n\r\n\tvar yIndex = 0;\r\n\tvar yNext2Lines = (this.codedWidth - this.width);\r\n\r\n\tvar rgbaIndex = 0;\t\r\n\tvar cols = this.width;\r\n\tvar rows = this.height;\r\n\r\n\tvar y;\r\n\r\n\tfor( var row = 0; row < rows; row++ ) {\r\n\t\tfor( var col = 0; col < cols; col++ ) {\r\n\t\t\ty = pY[yIndex++];\r\n\t\t\tpRGBA[rgbaIndex++] = 0xff000000 | y << 16 | y << 8 | y;\r\n\t\t}\r\n\t\t\r\n\t\tyIndex += yNext2Lines;\r\n\t}\r\n};\r\n\r\n\r\n\r\n\r\n// ----------------------------------------------------------------------------\r\n// Slice Layer\r\n\r\njsmpeg.prototype.quantizerScale = 0;\r\njsmpeg.prototype.sliceBegin = false;\r\n\r\njsmpeg.prototype.decodeSlice = function(slice) {\t\r\n\tthis.sliceBegin = true;\r\n\tthis.macroblockAddress = (slice - 1) * this.mbWidth - 1;\r\n\t\r\n\t// Reset motion vectors and DC predictors\r\n\tthis.motionFwH = this.motionFwHPrev = 0;\r\n\tthis.motionFwV = this.motionFwVPrev = 0;\r\n\tthis.dcPredictorY  = 128;\r\n\tthis.dcPredictorCr = 128;\r\n\tthis.dcPredictorCb = 128;\r\n\t\r\n\tthis.quantizerScale = this.buffer.getBits(5);\r\n\t\r\n\t// skip extra bits\r\n\twhile( this.buffer.getBits(1) ) {\r\n\t\tthis.buffer.advance(8);\r\n\t}\r\n\r\n\tdo {\r\n\t\tthis.decodeMacroblock();\r\n\t\t// We may have to ignore Video Stream Start Codes here (0xE0)!?\r\n\t} while( !this.buffer.nextBytesAreStartCode() );\r\n}\r\n\r\n\r\n// ----------------------------------------------------------------------------\r\n// Macroblock Layer\r\n\r\njsmpeg.prototype.macroblockAddress = 0;\r\njsmpeg.prototype.mbRow = 0;\r\njsmpeg.prototype.mbCol = 0;\r\n\t\r\njsmpeg.prototype.macroblockType = 0;\r\njsmpeg.prototype.macroblockIntra = false;\r\njsmpeg.prototype.macroblockMotFw = false;\r\n\t\r\njsmpeg.prototype.motionFwH = 0;\r\njsmpeg.prototype.motionFwV = 0;\r\njsmpeg.prototype.motionFwHPrev = 0;\r\njsmpeg.prototype.motionFwVPrev = 0;\r\n\r\njsmpeg.prototype.decodeMacroblock = function() {\r\n\t// Decode macroblock_address_increment\r\n\tvar \r\n\t\tincrement = 0,\r\n\t\tt = this.readCode(MACROBLOCK_ADDRESS_INCREMENT);\r\n\t\r\n\twhile( t == 34 ) {\r\n\t\t// macroblock_stuffing\r\n\t\tt = this.readCode(MACROBLOCK_ADDRESS_INCREMENT);\r\n\t}\r\n\twhile( t == 35 ) {\r\n\t\t// macroblock_escape\r\n\t\tincrement += 33;\r\n\t\tt = this.readCode(MACROBLOCK_ADDRESS_INCREMENT);\r\n\t}\r\n\tincrement += t;\r\n\r\n\t// Process any skipped macroblocks\r\n\tif( this.sliceBegin ) {\r\n\t\t// The first macroblock_address_increment of each slice is relative\r\n\t\t// to beginning of the preverious row, not the preverious macroblock\r\n\t\tthis.sliceBegin = false;\r\n\t\tthis.macroblockAddress += increment;\r\n\t}\r\n\telse {\r\n\t\tif( this.macroblockAddress + increment >= this.mbSize ) {\r\n\t\t\t// Illegal (too large) macroblock_address_increment\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif( increment > 1 ) {\r\n\t\t\t// Skipped macroblocks reset DC predictors\r\n\t\t\tthis.dcPredictorY  = 128;\r\n\t\t\tthis.dcPredictorCr = 128;\r\n\t\t\tthis.dcPredictorCb = 128;\r\n\t\t\t\r\n\t\t\t// Skipped macroblocks in P-pictures reset motion vectors\r\n\t\t\tif( this.pictureCodingType == PICTURE_TYPE_P ) {\r\n\t\t\t\tthis.motionFwH = this.motionFwHPrev = 0;\r\n\t\t\t\tthis.motionFwV = this.motionFwVPrev = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// Predict skipped macroblocks\r\n\t\twhile( increment > 1) {\r\n\t\t\tthis.macroblockAddress++;\r\n\t\t\tthis.mbRow = (this.macroblockAddress / this.mbWidth)|0;\r\n\t\t\tthis.mbCol = this.macroblockAddress % this.mbWidth;\r\n\t\t\tthis.copyMacroblock(this.motionFwH, this.motionFwV, this.forwardY, this.forwardCr, this.forwardCb);\r\n\t\t\tincrement--;\r\n\t\t}\r\n\t\tthis.macroblockAddress++;\r\n\t}\r\n\tthis.mbRow = (this.macroblockAddress / this.mbWidth)|0;\r\n\tthis.mbCol = this.macroblockAddress % this.mbWidth;\r\n\r\n\t// Process the current macroblock\r\n\tthis.macroblockType = this.readCode(MACROBLOCK_TYPE_TABLES[this.pictureCodingType]);\r\n\tthis.macroblockIntra = (this.macroblockType & 0x01);\r\n\tthis.macroblockMotFw = (this.macroblockType & 0x08);\r\n\r\n\t// Quantizer scale\r\n\tif( (this.macroblockType & 0x10) != 0 ) {\r\n\t\tthis.quantizerScale = this.buffer.getBits(5);\r\n\t}\r\n\r\n\tif( this.macroblockIntra ) {\r\n\t\t// Intra-coded macroblocks reset motion vectors\r\n\t\tthis.motionFwH = this.motionFwHPrev = 0;\r\n\t\tthis.motionFwV = this.motionFwVPrev = 0;\r\n\t}\r\n\telse {\r\n\t\t// Non-intra macroblocks reset DC predictors\r\n\t\tthis.dcPredictorY = 128;\r\n\t\tthis.dcPredictorCr = 128;\r\n\t\tthis.dcPredictorCb = 128;\r\n\t\t\r\n\t\tthis.decodeMotionVectors();\r\n\t\tthis.copyMacroblock(this.motionFwH, this.motionFwV, this.forwardY, this.forwardCr, this.forwardCb);\r\n\t}\r\n\r\n\t// Decode blocks\r\n\tvar cbp = ((this.macroblockType & 0x02) != 0) \r\n\t\t? this.readCode(CODE_BLOCK_PATTERN) \r\n\t\t: (this.macroblockIntra ? 0x3f : 0);\r\n\r\n\tfor( var block = 0, mask = 0x20; block < 6; block++ ) {\r\n\t\tif( (cbp & mask) != 0 ) {\r\n\t\t\tthis.decodeBlock(block);\r\n\t\t}\r\n\t\tmask >>= 1;\r\n\t}\r\n};\r\n\r\n\r\njsmpeg.prototype.decodeMotionVectors = function() {\r\n\tvar code, d, r = 0;\r\n\t\r\n\t// Forward\r\n\tif( this.macroblockMotFw ) {\r\n\t\t// Horizontal forward\r\n\t\tcode = this.readCode(MOTION);\r\n\t\tif( (code != 0) && (this.forwardF != 1) ) {\r\n\t\t\tr = this.buffer.getBits(this.forwardRSize);\r\n\t\t\td = ((Math.abs(code) - 1) << this.forwardRSize) + r + 1;\r\n\t\t\tif( code < 0 ) {\r\n\t\t\t\td = -d;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\td = code;\r\n\t\t}\r\n\t\t\r\n\t\tthis.motionFwHPrev += d;\r\n\t\tif( this.motionFwHPrev > (this.forwardF << 4) - 1 ) {\r\n\t\t\tthis.motionFwHPrev -= this.forwardF << 5;\r\n\t\t}\r\n\t\telse if( this.motionFwHPrev < ((-this.forwardF) << 4) ) {\r\n\t\t\tthis.motionFwHPrev += this.forwardF << 5;\r\n\t\t}\r\n\t\t\r\n\t\tthis.motionFwH = this.motionFwHPrev;\r\n\t\tif( this.fullPelForward ) {\r\n\t\t\tthis.motionFwH <<= 1;\r\n\t\t}\r\n\t\t\r\n\t\t// Vertical forward\r\n\t\tcode = this.readCode(MOTION);\r\n\t\tif( (code != 0) && (this.forwardF != 1) ) {\r\n\t\t\tr = this.buffer.getBits(this.forwardRSize);\r\n\t\t\td = ((Math.abs(code) - 1) << this.forwardRSize) + r + 1;\r\n\t\t\tif( code < 0 ) {\r\n\t\t\t\td = -d;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\td = code;\r\n\t\t}\r\n\t\t\r\n\t\tthis.motionFwVPrev += d;\r\n\t\tif( this.motionFwVPrev > (this.forwardF << 4) - 1 ) {\r\n\t\t\tthis.motionFwVPrev -= this.forwardF << 5;\r\n\t\t}\r\n\t\telse if( this.motionFwVPrev < ((-this.forwardF) << 4) ) {\r\n\t\t\tthis.motionFwVPrev += this.forwardF << 5;\r\n\t\t}\r\n\t\t\r\n\t\tthis.motionFwV = this.motionFwVPrev;\r\n\t\tif( this.fullPelForward ) {\r\n\t\t\tthis.motionFwV <<= 1;\r\n\t\t}\r\n\t}\r\n\telse if( this.pictureCodingType == PICTURE_TYPE_P ) {\r\n\t\t// No motion information in P-picture, reset vectors\r\n\t\tthis.motionFwH = this.motionFwHPrev = 0;\r\n\t\tthis.motionFwV = this.motionFwVPrev = 0;\r\n\t}\r\n};\r\n\r\njsmpeg.prototype.copyMacroblock = function(motionH, motionV, sY, sCr, sCb ) {\r\n\tvar \r\n\t\twidth, scan, \r\n\t\tH, V, oddH, oddV,\r\n\t\tsrc, dest, last;\r\n\r\n\t// We use 32bit writes here\r\n\tvar dY = this.currentY32;\r\n\tvar dCb = this.currentCb32;\r\n\tvar dCr = this.currentCr32;\r\n\r\n\t// Luminance\r\n\twidth = this.codedWidth;\r\n\tscan = width - 16;\r\n\t\r\n\tH = motionH >> 1;\r\n\tV = motionV >> 1;\r\n\toddH = (motionH & 1) == 1;\r\n\toddV = (motionV & 1) == 1;\r\n\t\r\n\tsrc = ((this.mbRow << 4) + V) * width + (this.mbCol << 4) + H;\r\n\tdest = (this.mbRow * width + this.mbCol) << 2;\r\n\tlast = dest + (width << 2);\r\n\r\n\tvar y1, y2, y;\r\n\tif( oddH ) {\r\n\t\tif( oddV ) {\r\n\t\t\twhile( dest < last ) {\r\n\t\t\t\ty1 = sY[src] + sY[src+width]; src++;\r\n\t\t\t\tfor( var x = 0; x < 4; x++ ) {\r\n\t\t\t\t\ty2 = sY[src] + sY[src+width]; src++;\r\n\t\t\t\t\ty = (((y1 + y2 + 2) >> 2) & 0xff);\r\n\r\n\t\t\t\t\ty1 = sY[src] + sY[src+width]; src++;\r\n\t\t\t\t\ty |= (((y1 + y2 + 2) << 6) & 0xff00);\r\n\t\t\t\t\t\r\n\t\t\t\t\ty2 = sY[src] + sY[src+width]; src++;\r\n\t\t\t\t\ty |= (((y1 + y2 + 2) << 14) & 0xff0000);\r\n\r\n\t\t\t\t\ty1 = sY[src] + sY[src+width]; src++;\r\n\t\t\t\t\ty |= (((y1 + y2 + 2) << 22) & 0xff000000);\r\n\r\n\t\t\t\t\tdY[dest++] = y;\r\n\t\t\t\t}\r\n\t\t\t\tdest += scan >> 2; src += scan-1;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\twhile( dest < last ) {\r\n\t\t\t\ty1 = sY[src++];\r\n\t\t\t\tfor( var x = 0; x < 4; x++ ) {\r\n\t\t\t\t\ty2 = sY[src++];\r\n\t\t\t\t\ty = (((y1 + y2 + 1) >> 1) & 0xff);\r\n\t\t\t\t\t\r\n\t\t\t\t\ty1 = sY[src++];\r\n\t\t\t\t\ty |= (((y1 + y2 + 1) << 7) & 0xff00);\r\n\t\t\t\t\t\r\n\t\t\t\t\ty2 = sY[src++];\r\n\t\t\t\t\ty |= (((y1 + y2 + 1) << 15) & 0xff0000);\r\n\t\t\t\t\t\r\n\t\t\t\t\ty1 = sY[src++];\r\n\t\t\t\t\ty |= (((y1 + y2 + 1) << 23) & 0xff000000);\r\n\r\n\t\t\t\t\tdY[dest++] = y;\r\n\t\t\t\t}\r\n\t\t\t\tdest += scan >> 2; src += scan-1;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tif( oddV ) {\r\n\t\t\twhile( dest < last ) {\r\n\t\t\t\tfor( var x = 0; x < 4; x++ ) {\r\n\t\t\t\t\ty = (((sY[src] + sY[src+width] + 1) >> 1) & 0xff); src++;\r\n\t\t\t\t\ty |= (((sY[src] + sY[src+width] + 1) << 7) & 0xff00); src++;\r\n\t\t\t\t\ty |= (((sY[src] + sY[src+width] + 1) << 15) & 0xff0000); src++;\r\n\t\t\t\t\ty |= (((sY[src] + sY[src+width] + 1) << 23) & 0xff000000); src++;\r\n\t\t\t\t\t\r\n\t\t\t\t\tdY[dest++] = y;\r\n\t\t\t\t}\r\n\t\t\t\tdest += scan >> 2; src += scan;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\twhile( dest < last ) {\r\n\t\t\t\tfor( var x = 0; x < 4; x++ ) {\r\n\t\t\t\t\ty = sY[src]; src++;\r\n\t\t\t\t\ty |= sY[src] << 8; src++;\r\n\t\t\t\t\ty |= sY[src] << 16; src++;\r\n\t\t\t\t\ty |= sY[src] << 24; src++;\r\n\r\n\t\t\t\t\tdY[dest++] = y;\r\n\t\t\t\t}\r\n\t\t\t\tdest += scan >> 2; src += scan;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tif( this.bwFilter ) {\r\n\t\t// No need to copy chrominance when black&white filter is active\r\n\t\treturn;\r\n\t}\r\n\t\r\n\r\n\t// Chrominance\r\n\t\r\n\twidth = this.halfWidth;\r\n\tscan = width - 8;\r\n\t\r\n\tH = (motionH/2) >> 1;\r\n\tV = (motionV/2) >> 1;\r\n\toddH = ((motionH/2) & 1) == 1;\r\n\toddV = ((motionV/2) & 1) == 1;\r\n\t\r\n\tsrc = ((this.mbRow << 3) + V) * width + (this.mbCol << 3) + H;\r\n\tdest = (this.mbRow * width + this.mbCol) << 1;\r\n\tlast = dest + (width << 1);\r\n\t\r\n\tvar cr1, cr2, cr;\r\n\tvar cb1, cb2, cb;\r\n\tif( oddH ) {\r\n\t\tif( oddV ) {\r\n\t\t\twhile( dest < last ) {\r\n\t\t\t\tcr1 = sCr[src] + sCr[src+width];\r\n\t\t\t\tcb1 = sCb[src] + sCb[src+width];\r\n\t\t\t\tsrc++;\r\n\t\t\t\tfor( var x = 0; x < 2; x++ ) {\r\n\t\t\t\t\tcr2 = sCr[src] + sCr[src+width];\r\n\t\t\t\t\tcb2 = sCb[src] + sCb[src+width]; src++;\r\n\t\t\t\t\tcr = (((cr1 + cr2 + 2) >> 2) & 0xff);\r\n\t\t\t\t\tcb = (((cb1 + cb2 + 2) >> 2) & 0xff);\r\n\r\n\t\t\t\t\tcr1 = sCr[src] + sCr[src+width];\r\n\t\t\t\t\tcb1 = sCb[src] + sCb[src+width]; src++;\r\n\t\t\t\t\tcr |= (((cr1 + cr2 + 2) << 6) & 0xff00);\r\n\t\t\t\t\tcb |= (((cb1 + cb2 + 2) << 6) & 0xff00);\r\n\r\n\t\t\t\t\tcr2 = sCr[src] + sCr[src+width];\r\n\t\t\t\t\tcb2 = sCb[src] + sCb[src+width]; src++;\r\n\t\t\t\t\tcr |= (((cr1 + cr2 + 2) << 14) & 0xff0000);\r\n\t\t\t\t\tcb |= (((cb1 + cb2 + 2) << 14) & 0xff0000);\r\n\r\n\t\t\t\t\tcr1 = sCr[src] + sCr[src+width];\r\n\t\t\t\t\tcb1 = sCb[src] + sCb[src+width]; src++;\r\n\t\t\t\t\tcr |= (((cr1 + cr2 + 2) << 22) & 0xff000000);\r\n\t\t\t\t\tcb |= (((cb1 + cb2 + 2) << 22) & 0xff000000);\r\n\r\n\t\t\t\t\tdCr[dest] = cr;\r\n\t\t\t\t\tdCb[dest] = cb;\r\n\t\t\t\t\tdest++;\r\n\t\t\t\t}\r\n\t\t\t\tdest += scan >> 2; src += scan-1;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\twhile( dest < last ) {\r\n\t\t\t\tcr1 = sCr[src];\r\n\t\t\t\tcb1 = sCb[src];\r\n\t\t\t\tsrc++;\r\n\t\t\t\tfor( var x = 0; x < 2; x++ ) {\r\n\t\t\t\t\tcr2 = sCr[src];\r\n\t\t\t\t\tcb2 = sCb[src++];\r\n\t\t\t\t\tcr = (((cr1 + cr2 + 1) >> 1) & 0xff);\r\n\t\t\t\t\tcb = (((cb1 + cb2 + 1) >> 1) & 0xff);\r\n\r\n\t\t\t\t\tcr1 = sCr[src];\r\n\t\t\t\t\tcb1 = sCb[src++];\r\n\t\t\t\t\tcr |= (((cr1 + cr2 + 1) << 7) & 0xff00);\r\n\t\t\t\t\tcb |= (((cb1 + cb2 + 1) << 7) & 0xff00);\r\n\r\n\t\t\t\t\tcr2 = sCr[src];\r\n\t\t\t\t\tcb2 = sCb[src++];\r\n\t\t\t\t\tcr |= (((cr1 + cr2 + 1) << 15) & 0xff0000);\r\n\t\t\t\t\tcb |= (((cb1 + cb2 + 1) << 15) & 0xff0000);\r\n\r\n\t\t\t\t\tcr1 = sCr[src];\r\n\t\t\t\t\tcb1 = sCb[src++];\r\n\t\t\t\t\tcr |= (((cr1 + cr2 + 1) << 23) & 0xff000000);\r\n\t\t\t\t\tcb |= (((cb1 + cb2 + 1) << 23) & 0xff000000);\r\n\r\n\t\t\t\t\tdCr[dest] = cr;\r\n\t\t\t\t\tdCb[dest] = cb;\r\n\t\t\t\t\tdest++;\r\n\t\t\t\t}\r\n\t\t\t\tdest += scan >> 2; src += scan-1;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tif( oddV ) {\r\n\t\t\twhile( dest < last ) {\r\n\t\t\t\tfor( var x = 0; x < 2; x++ ) {\r\n\t\t\t\t\tcr = (((sCr[src] + sCr[src+width] + 1) >> 1) & 0xff);\r\n\t\t\t\t\tcb = (((sCb[src] + sCb[src+width] + 1) >> 1) & 0xff); src++;\r\n\r\n\t\t\t\t\tcr |= (((sCr[src] + sCr[src+width] + 1) << 7) & 0xff00);\r\n\t\t\t\t\tcb |= (((sCb[src] + sCb[src+width] + 1) << 7) & 0xff00); src++;\r\n\r\n\t\t\t\t\tcr |= (((sCr[src] + sCr[src+width] + 1) << 15) & 0xff0000);\r\n\t\t\t\t\tcb |= (((sCb[src] + sCb[src+width] + 1) << 15) & 0xff0000); src++;\r\n\r\n\t\t\t\t\tcr |= (((sCr[src] + sCr[src+width] + 1) << 23) & 0xff000000);\r\n\t\t\t\t\tcb |= (((sCb[src] + sCb[src+width] + 1) << 23) & 0xff000000); src++;\r\n\t\t\t\t\t\r\n\t\t\t\t\tdCr[dest] = cr;\r\n\t\t\t\t\tdCb[dest] = cb;\r\n\t\t\t\t\tdest++;\r\n\t\t\t\t}\r\n\t\t\t\tdest += scan >> 2; src += scan;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\twhile( dest < last ) {\r\n\t\t\t\tfor( var x = 0; x < 2; x++ ) {\r\n\t\t\t\t\tcr = sCr[src];\r\n\t\t\t\t\tcb = sCb[src]; src++;\r\n\r\n\t\t\t\t\tcr |= sCr[src] << 8;\r\n\t\t\t\t\tcb |= sCb[src] << 8; src++;\r\n\r\n\t\t\t\t\tcr |= sCr[src] << 16;\r\n\t\t\t\t\tcb |= sCb[src] << 16; src++;\r\n\r\n\t\t\t\t\tcr |= sCr[src] << 24;\r\n\t\t\t\t\tcb |= sCb[src] << 24; src++;\r\n\r\n\t\t\t\t\tdCr[dest] = cr;\r\n\t\t\t\t\tdCb[dest] = cb;\r\n\t\t\t\t\tdest++;\r\n\t\t\t\t}\r\n\t\t\t\tdest += scan >> 2; src += scan;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\n\r\n// ----------------------------------------------------------------------------\r\n// Block layer\r\n\r\njsmpeg.prototype.dcPredictorY;\r\njsmpeg.prototype.dcPredictorCr;\r\njsmpeg.prototype.dcPredictorCb;\r\n\r\njsmpeg.prototype.blockData = null;\r\njsmpeg.prototype.decodeBlock = function(block) {\r\n\t\r\n\tvar\r\n\t\tn = 0,\r\n\t\tquantMatrix;\r\n\t\r\n\t// Clear preverious data\r\n\tthis.fillArray(this.blockData, 0);\r\n\t\r\n\t// Decode DC coefficient of intra-coded blocks\r\n\tif( this.macroblockIntra ) {\r\n\t\tvar \r\n\t\t\tpredictor,\r\n\t\t\tdctSize;\r\n\t\t\r\n\t\t// DC prediction\r\n\t\t\r\n\t\tif( block < 4 ) {\r\n\t\t\tpredictor = this.dcPredictorY;\r\n\t\t\tdctSize = this.readCode(DCT_DC_SIZE_LUMINANCE);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tpredictor = (block == 4 ? this.dcPredictorCr : this.dcPredictorCb);\r\n\t\t\tdctSize = this.readCode(DCT_DC_SIZE_CHROMINANCE);\r\n\t\t}\r\n\t\t\r\n\t\t// Read DC coeff\r\n\t\tif( dctSize > 0 ) {\r\n\t\t\tvar differential = this.buffer.getBits(dctSize);\r\n\t\t\tif( (differential & (1 << (dctSize - 1))) != 0 ) {\r\n\t\t\t\tthis.blockData[0] = predictor + differential;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.blockData[0] = predictor + ((-1 << dctSize)|(differential+1));\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.blockData[0] = predictor;\r\n\t\t}\r\n\t\t\r\n\t\t// Save predictor value\r\n\t\tif( block < 4 ) {\r\n\t\t\tthis.dcPredictorY = this.blockData[0];\r\n\t\t}\r\n\t\telse if( block == 4 ) {\r\n\t\t\tthis.dcPredictorCr = this.blockData[0];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.dcPredictorCb = this.blockData[0];\r\n\t\t}\r\n\t\t\r\n\t\t// Dequantize + premultiply\r\n\t\tthis.blockData[0] <<= (3 + 5);\r\n\t\t\r\n\t\tquantMatrix = this.intraQuantMatrix;\r\n\t\tn = 1;\r\n\t}\r\n\telse {\r\n\t\tquantMatrix = this.nonIntraQuantMatrix;\r\n\t}\r\n\t\r\n\t// Decode AC coefficients (+DC for non-intra)\r\n\tvar level = 0;\r\n\twhile( true ) {\r\n\t\tvar \r\n\t\t\trun = 0,\r\n\t\t\tcoeff = this.readCode(DCT_COEFF);\r\n\t\t\r\n\t\tif( (coeff == 0x0001) && (n > 0) && (this.buffer.getBits(1) == 0) ) {\r\n\t\t\t// end_of_block\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tif( coeff == 0xffff ) {\r\n\t\t\t// escape\r\n\t\t\trun = this.buffer.getBits(6);\r\n\t\t\tlevel = this.buffer.getBits(8);\r\n\t\t\tif( level == 0 ) {\r\n\t\t\t\tlevel = this.buffer.getBits(8);\r\n\t\t\t}\r\n\t\t\telse if( level == 128 ) {\r\n\t\t\t\tlevel = this.buffer.getBits(8) - 256;\r\n\t\t\t}\r\n\t\t\telse if( level > 128 ) {\r\n\t\t\t\tlevel = level - 256;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\trun = coeff >> 8;\r\n\t\t\tlevel = coeff & 0xff;\r\n\t\t\tif( this.buffer.getBits(1) ) {\r\n\t\t\t\tlevel = -level;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tn += run;\r\n\t\tvar dezigZagged = ZIG_ZAG[n];\r\n\t\tn++;\r\n\t\t\r\n\t\t// Dequantize, oddify, clip\r\n\t\tlevel <<= 1;\r\n\t\tif( !this.macroblockIntra ) {\r\n\t\t\tlevel += (level < 0 ? -1 : 1);\r\n\t\t}\r\n\t\tlevel = (level * this.quantizerScale * quantMatrix[dezigZagged]) >> 4;\r\n\t\tif( (level & 1) == 0 ) {\r\n\t\t\tlevel -= level > 0 ? 1 : -1;\r\n\t\t}\r\n\t\tif( level > 2047 ) {\r\n\t\t\tlevel = 2047;\r\n\t\t}\r\n\t\telse if( level < -2048 ) {\r\n\t\t\tlevel = -2048;\r\n\t\t}\r\n\r\n\t\t// Save premultiplied coefficient\r\n\t\tthis.blockData[dezigZagged] = level * PREMULTIPLIER_MATRIX[dezigZagged];\r\n\t};\r\n\t\r\n\t// Transform block data to the spatial domain\r\n\tif( n == 1 ) {\r\n\t\t// Only DC coeff., no IDCT needed\r\n\t\tthis.fillArray(this.blockData, (this.blockData[0] + 128) >> 8);\r\n\t}\r\n\telse {\r\n\t\tthis.IDCT();\r\n\t}\r\n\t\r\n\t// Move block to its place\r\n\tvar\r\n\t\tdestArray,\r\n\t\tdestIndex,\r\n\t\tscan;\r\n\t\r\n\tif( block < 4 ) {\r\n\t\tdestArray = this.currentY;\r\n\t\tscan = this.codedWidth - 8;\r\n\t\tdestIndex = (this.mbRow * this.codedWidth + this.mbCol) << 4;\r\n\t\tif( (block & 1) != 0 ) {\r\n\t\t\tdestIndex += 8;\r\n\t\t}\r\n\t\tif( (block & 2) != 0 ) {\r\n\t\t\tdestIndex += this.codedWidth << 3;\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tdestArray = (block == 4) ? this.currentCb : this.currentCr;\r\n\t\tscan = (this.codedWidth >> 1) - 8;\r\n\t\tdestIndex = ((this.mbRow * this.codedWidth) << 2) + (this.mbCol << 3);\r\n\t}\r\n\t\r\n\tn = 0;\r\n\t\r\n\tvar blockData = this.blockData;\r\n\tif( this.macroblockIntra ) {\r\n\t\t// Overwrite (no prediction)\r\n\t\tthis.copyBlockToDestination(this.blockData, destArray, destIndex, scan);\r\n\t}\r\n\telse {\r\n\t\t// Add data to the predicted macroblock\r\n\t\tthis.addBlockToDestination(this.blockData, destArray, destIndex, scan);\r\n\t}\r\n};\r\n\r\n\r\njsmpeg.prototype.copyBlockToDestination = function(blockData, destArray, destIndex, scan) {\r\n\tvar n = 0;\r\n\tfor( var i = 0; i < 8; i++ ) {\r\n\t\tfor( var j = 0; j < 8; j++ ) {\r\n\t\t\tdestArray[destIndex++] = blockData[n++];\r\n\t\t}\r\n\t\tdestIndex += scan;\r\n\t}\r\n};\r\n\r\njsmpeg.prototype.addBlockToDestination = function(blockData, destArray, destIndex, scan) {\r\n\tvar n = 0;\r\n\tfor( var i = 0; i < 8; i++ ) {\r\n\t\tfor( var j = 0; j < 8; j++ ) {\r\n\t\t\tdestArray[destIndex++] += blockData[n++];\r\n\t\t}\r\n\t\tdestIndex += scan;\r\n\t}\r\n};\r\n\r\n// Clamping version for shitty browsers (IE) that don't support Uint8ClampedArray\r\njsmpeg.prototype.copyBlockToDestinationClamp = function(blockData, destArray, destIndex, scan) {\r\n\tvar n = 0;\r\n\tfor( var i = 0; i < 8; i++ ) {\r\n\t\tfor( var j = 0; j < 8; j++ ) {\r\n\t\t\tvar p = blockData[n++];\r\n\t\t\tdestArray[destIndex++] = p > 255 ? 255 : (p < 0 ? 0 : p);\r\n\t\t}\r\n\t\tdestIndex += scan;\r\n\t}\r\n};\r\n\r\njsmpeg.prototype.addBlockToDestinationClamp = function(blockData, destArray, destIndex, scan) {\r\n\tvar n = 0;\r\n\tfor( var i = 0; i < 8; i++ ) {\r\n\t\tfor( var j = 0; j < 8; j++ ) {\r\n\t\t\tvar p = blockData[n++] + destArray[destIndex];\r\n\t\t\tdestArray[destIndex++] = p > 255 ? 255 : (p < 0 ? 0 : p);\r\n\t\t}\r\n\t\tdestIndex += scan;\r\n\t}\r\n};\r\n\r\njsmpeg.prototype.IDCT = function() {\r\n\t// See http://vsr.informatik.tu-chemnitz.de/~jan/MPEG/HTML/IDCT.html\r\n\t// for more info.\r\n\t\r\n\tvar \r\n\t\tb1, b3, b4, b6, b7, tmp1, tmp2, m0,\r\n\t\tx0, x1, x2, x3, x4, y3, y4, y5, y6, y7,\r\n\t\ti,\r\n\t\tblockData = this.blockData;\r\n\t\r\n\t// Transform columns\r\n\tfor( i = 0; i < 8; ++i ) {\r\n\t\tb1 =  blockData[4*8+i];\r\n\t\tb3 =  blockData[2*8+i] + blockData[6*8+i];\r\n\t\tb4 =  blockData[5*8+i] - blockData[3*8+i];\r\n\t\ttmp1 = blockData[1*8+i] + blockData[7*8+i];\r\n\t\ttmp2 = blockData[3*8+i] + blockData[5*8+i];\r\n\t\tb6 = blockData[1*8+i] - blockData[7*8+i];\r\n\t\tb7 = tmp1 + tmp2;\r\n\t\tm0 =  blockData[0*8+i];\r\n\t\tx4 =  ((b6*473 - b4*196 + 128) >> 8) - b7;\r\n\t\tx0 =  x4 - (((tmp1 - tmp2)*362 + 128) >> 8);\r\n\t\tx1 =  m0 - b1;\r\n\t\tx2 =  (((blockData[2*8+i] - blockData[6*8+i])*362 + 128) >> 8) - b3;\r\n\t\tx3 =  m0 + b1;\r\n\t\ty3 =  x1 + x2;\r\n\t\ty4 =  x3 + b3;\r\n\t\ty5 =  x1 - x2;\r\n\t\ty6 =  x3 - b3;\r\n\t\ty7 = -x0 - ((b4*473 + b6*196 + 128) >> 8);\r\n\t\tblockData[0*8+i] =  b7 + y4;\r\n\t\tblockData[1*8+i] =  x4 + y3;\r\n\t\tblockData[2*8+i] =  y5 - x0;\r\n\t\tblockData[3*8+i] =  y6 - y7;\r\n\t\tblockData[4*8+i] =  y6 + y7;\r\n\t\tblockData[5*8+i] =  x0 + y5;\r\n\t\tblockData[6*8+i] =  y3 - x4;\r\n\t\tblockData[7*8+i] =  y4 - b7;\r\n\t}\r\n\t\r\n\t// Transform rows\r\n\tfor( i = 0; i < 64; i += 8 ) {\r\n\t\tb1 =  blockData[4+i];\r\n\t\tb3 =  blockData[2+i] + blockData[6+i];\r\n\t\tb4 =  blockData[5+i] - blockData[3+i];\r\n\t\ttmp1 = blockData[1+i] + blockData[7+i];\r\n\t\ttmp2 = blockData[3+i] + blockData[5+i];\r\n\t\tb6 = blockData[1+i] - blockData[7+i];\r\n\t\tb7 = tmp1 + tmp2;\r\n\t\tm0 =  blockData[0+i];\r\n\t\tx4 =  ((b6*473 - b4*196 + 128) >> 8) - b7;\r\n\t\tx0 =  x4 - (((tmp1 - tmp2)*362 + 128) >> 8);\r\n\t\tx1 =  m0 - b1;\r\n\t\tx2 =  (((blockData[2+i] - blockData[6+i])*362 + 128) >> 8) - b3;\r\n\t\tx3 =  m0 + b1;\r\n\t\ty3 =  x1 + x2;\r\n\t\ty4 =  x3 + b3;\r\n\t\ty5 =  x1 - x2;\r\n\t\ty6 =  x3 - b3;\r\n\t\ty7 = -x0 - ((b4*473 + b6*196 + 128) >> 8);\r\n\t\tblockData[0+i] =  (b7 + y4 + 128) >> 8;\r\n\t\tblockData[1+i] =  (x4 + y3 + 128) >> 8;\r\n\t\tblockData[2+i] =  (y5 - x0 + 128) >> 8;\r\n\t\tblockData[3+i] =  (y6 - y7 + 128) >> 8;\r\n\t\tblockData[4+i] =  (y6 + y7 + 128) >> 8;\r\n\t\tblockData[5+i] =  (x0 + y5 + 128) >> 8;\r\n\t\tblockData[6+i] =  (y3 - x4 + 128) >> 8;\r\n\t\tblockData[7+i] =  (y4 - b7 + 128) >> 8;\r\n\t}\r\n};\r\n\r\n\r\n// ----------------------------------------------------------------------------\r\n// VLC Tables and Constants\r\n\r\nvar\r\n\tSOCKET_MAGIC_BYTES = 'jsmp',\r\n\tDECODE_SKIP_OUTPUT = 1,\r\n\tPICTURE_RATE = [\r\n\t\t0.000, 23.976, 24.000, 25.000, 29.970, 30.000, 50.000, 59.940,\r\n\t\t60.000,  0.000,  0.000,  0.000,  0.000,  0.000,  0.000,  0.000\r\n\t],\r\n\tZIG_ZAG = new Uint8Array([\r\n\t\t 0,  1,  8, 16,  9,  2,  3, 10,\r\n\t\t17, 24, 32, 25, 18, 11,  4,  5,\r\n\t\t12, 19, 26, 33, 40, 48, 41, 34,\r\n\t\t27, 20, 13,  6,  7, 14, 21, 28,\r\n\t\t35, 42, 49, 56, 57, 50, 43, 36,\r\n\t\t29, 22, 15, 23, 30, 37, 44, 51,\r\n\t\t58, 59, 52, 45, 38, 31, 39, 46,\r\n\t\t53, 60, 61, 54, 47, 55, 62, 63\r\n\t]),\r\n\tDEFAULT_INTRA_QUANT_MATRIX = new Uint8Array([\r\n\t\t 8, 16, 19, 22, 26, 27, 29, 34,\r\n\t\t16, 16, 22, 24, 27, 29, 34, 37,\r\n\t\t19, 22, 26, 27, 29, 34, 34, 38,\r\n\t\t22, 22, 26, 27, 29, 34, 37, 40,\r\n\t\t22, 26, 27, 29, 32, 35, 40, 48,\r\n\t\t26, 27, 29, 32, 35, 40, 48, 58,\r\n\t\t26, 27, 29, 34, 38, 46, 56, 69,\r\n\t\t27, 29, 35, 38, 46, 56, 69, 83\r\n\t]),\r\n\tDEFAULT_NON_INTRA_QUANT_MATRIX = new Uint8Array([\r\n\t\t16, 16, 16, 16, 16, 16, 16, 16,\r\n\t\t16, 16, 16, 16, 16, 16, 16, 16,\r\n\t\t16, 16, 16, 16, 16, 16, 16, 16,\r\n\t\t16, 16, 16, 16, 16, 16, 16, 16,\r\n\t\t16, 16, 16, 16, 16, 16, 16, 16,\r\n\t\t16, 16, 16, 16, 16, 16, 16, 16,\r\n\t\t16, 16, 16, 16, 16, 16, 16, 16,\r\n\t\t16, 16, 16, 16, 16, 16, 16, 16\r\n\t]),\r\n\t\r\n\tPREMULTIPLIER_MATRIX = new Uint8Array([\r\n\t\t32, 44, 42, 38, 32, 25, 17,  9,\r\n\t\t44, 62, 58, 52, 44, 35, 24, 12,\r\n\t\t42, 58, 55, 49, 42, 33, 23, 12,\r\n\t\t38, 52, 49, 44, 38, 30, 20, 10,\r\n\t\t32, 44, 42, 38, 32, 25, 17,  9,\r\n\t\t25, 35, 33, 30, 25, 20, 14,  7,\r\n\t\t17, 24, 23, 20, 17, 14,  9,  5,\r\n\t\t 9, 12, 12, 10,  9,  7,  5,  2\r\n\t]),\r\n\t\r\n\t// MPEG-1 VLC\r\n\t\r\n\t//  macroblock_stuffing decodes as 34.\r\n\t//  macroblock_escape decodes as 35.\r\n\t\r\n\tMACROBLOCK_ADDRESS_INCREMENT = new Int16Array([\r\n\t\t 1*3,  2*3,  0, //   0\r\n\t\t 3*3,  4*3,  0, //   1  0\r\n\t\t   0,    0,  1, //   2  1.\r\n\t\t 5*3,  6*3,  0, //   3  00\r\n\t\t 7*3,  8*3,  0, //   4  01\r\n\t\t 9*3, 10*3,  0, //   5  000\r\n\t\t11*3, 12*3,  0, //   6  001\r\n\t\t   0,    0,  3, //   7  010.\r\n\t\t   0,    0,  2, //   8  011.\r\n\t\t13*3, 14*3,  0, //   9  0000\r\n\t\t15*3, 16*3,  0, //  10  0001\r\n\t\t   0,    0,  5, //  11  0010.\r\n\t\t   0,    0,  4, //  12  0011.\r\n\t\t17*3, 18*3,  0, //  13  0000 0\r\n\t\t19*3, 20*3,  0, //  14  0000 1\r\n\t\t   0,    0,  7, //  15  0001 0.\r\n\t\t   0,    0,  6, //  16  0001 1.\r\n\t\t21*3, 22*3,  0, //  17  0000 00\r\n\t\t23*3, 24*3,  0, //  18  0000 01\r\n\t\t25*3, 26*3,  0, //  19  0000 10\r\n\t\t27*3, 28*3,  0, //  20  0000 11\r\n\t\t  -1, 29*3,  0, //  21  0000 000\r\n\t\t  -1, 30*3,  0, //  22  0000 001\r\n\t\t31*3, 32*3,  0, //  23  0000 010\r\n\t\t33*3, 34*3,  0, //  24  0000 011\r\n\t\t35*3, 36*3,  0, //  25  0000 100\r\n\t\t37*3, 38*3,  0, //  26  0000 101\r\n\t\t   0,    0,  9, //  27  0000 110.\r\n\t\t   0,    0,  8, //  28  0000 111.\r\n\t\t39*3, 40*3,  0, //  29  0000 0001\r\n\t\t41*3, 42*3,  0, //  30  0000 0011\r\n\t\t43*3, 44*3,  0, //  31  0000 0100\r\n\t\t45*3, 46*3,  0, //  32  0000 0101\r\n\t\t   0,    0, 15, //  33  0000 0110.\r\n\t\t   0,    0, 14, //  34  0000 0111.\r\n\t\t   0,    0, 13, //  35  0000 1000.\r\n\t\t   0,    0, 12, //  36  0000 1001.\r\n\t\t   0,    0, 11, //  37  0000 1010.\r\n\t\t   0,    0, 10, //  38  0000 1011.\r\n\t\t47*3,   -1,  0, //  39  0000 0001 0\r\n\t\t  -1, 48*3,  0, //  40  0000 0001 1\r\n\t\t49*3, 50*3,  0, //  41  0000 0011 0\r\n\t\t51*3, 52*3,  0, //  42  0000 0011 1\r\n\t\t53*3, 54*3,  0, //  43  0000 0100 0\r\n\t\t55*3, 56*3,  0, //  44  0000 0100 1\r\n\t\t57*3, 58*3,  0, //  45  0000 0101 0\r\n\t\t59*3, 60*3,  0, //  46  0000 0101 1\r\n\t\t61*3,   -1,  0, //  47  0000 0001 00\r\n\t\t  -1, 62*3,  0, //  48  0000 0001 11\r\n\t\t63*3, 64*3,  0, //  49  0000 0011 00\r\n\t\t65*3, 66*3,  0, //  50  0000 0011 01\r\n\t\t67*3, 68*3,  0, //  51  0000 0011 10\r\n\t\t69*3, 70*3,  0, //  52  0000 0011 11\r\n\t\t71*3, 72*3,  0, //  53  0000 0100 00\r\n\t\t73*3, 74*3,  0, //  54  0000 0100 01\r\n\t\t   0,    0, 21, //  55  0000 0100 10.\r\n\t\t   0,    0, 20, //  56  0000 0100 11.\r\n\t\t   0,    0, 19, //  57  0000 0101 00.\r\n\t\t   0,    0, 18, //  58  0000 0101 01.\r\n\t\t   0,    0, 17, //  59  0000 0101 10.\r\n\t\t   0,    0, 16, //  60  0000 0101 11.\r\n\t\t   0,    0, 35, //  61  0000 0001 000. -- macroblock_escape\r\n\t\t   0,    0, 34, //  62  0000 0001 111. -- macroblock_stuffing\r\n\t\t   0,    0, 33, //  63  0000 0011 000.\r\n\t\t   0,    0, 32, //  64  0000 0011 001.\r\n\t\t   0,    0, 31, //  65  0000 0011 010.\r\n\t\t   0,    0, 30, //  66  0000 0011 011.\r\n\t\t   0,    0, 29, //  67  0000 0011 100.\r\n\t\t   0,    0, 28, //  68  0000 0011 101.\r\n\t\t   0,    0, 27, //  69  0000 0011 110.\r\n\t\t   0,    0, 26, //  70  0000 0011 111.\r\n\t\t   0,    0, 25, //  71  0000 0100 000.\r\n\t\t   0,    0, 24, //  72  0000 0100 001.\r\n\t\t   0,    0, 23, //  73  0000 0100 010.\r\n\t\t   0,    0, 22  //  74  0000 0100 011.\r\n\t]),\r\n\t\r\n\t//  macroblock_type bitmap:\r\n\t//    0x10  macroblock_quant\r\n\t//    0x08  macroblock_motion_forward\r\n\t//    0x04  macroblock_motion_backward\r\n\t//    0x02  macrobkock_pattern\r\n\t//    0x01  macroblock_intra\r\n\t//\r\n\t\r\n\tMACROBLOCK_TYPE_I = new Int8Array([\r\n\t\t 1*3,  2*3,     0, //   0\r\n\t\t  -1,  3*3,     0, //   1  0\r\n\t\t   0,    0,  0x01, //   2  1.\r\n\t\t   0,    0,  0x11  //   3  01.\r\n\t]),\r\n\t\r\n\tMACROBLOCK_TYPE_P = new Int8Array([\r\n\t\t 1*3,  2*3,     0, //  0\r\n\t\t 3*3,  4*3,     0, //  1  0\r\n\t\t   0,    0,  0x0a, //  2  1.\r\n\t\t 5*3,  6*3,     0, //  3  00\r\n\t\t   0,    0,  0x02, //  4  01.\r\n\t\t 7*3,  8*3,     0, //  5  000\r\n\t\t   0,    0,  0x08, //  6  001.\r\n\t\t 9*3, 10*3,     0, //  7  0000\r\n\t\t11*3, 12*3,     0, //  8  0001\r\n\t\t  -1, 13*3,     0, //  9  00000\r\n\t\t   0,    0,  0x12, // 10  00001.\r\n\t\t   0,    0,  0x1a, // 11  00010.\r\n\t\t   0,    0,  0x01, // 12  00011.\r\n\t\t   0,    0,  0x11  // 13  000001.\r\n\t]),\r\n\t\r\n\tMACROBLOCK_TYPE_B = new Int8Array([\r\n\t\t 1*3,  2*3,     0,  //  0\r\n\t\t 3*3,  5*3,     0,  //  1  0\r\n\t\t 4*3,  6*3,     0,  //  2  1\r\n\t\t 8*3,  7*3,     0,  //  3  00\r\n\t\t   0,    0,  0x0c,  //  4  10.\r\n\t\t 9*3, 10*3,     0,  //  5  01\r\n\t\t   0,    0,  0x0e,  //  6  11.\r\n\t\t13*3, 14*3,     0,  //  7  001\r\n\t\t12*3, 11*3,     0,  //  8  000\r\n\t\t   0,    0,  0x04,  //  9  010.\r\n\t\t   0,    0,  0x06,  // 10  011.\r\n\t\t18*3, 16*3,     0,  // 11  0001\r\n\t\t15*3, 17*3,     0,  // 12  0000\r\n\t\t   0,    0,  0x08,  // 13  0010.\r\n\t\t   0,    0,  0x0a,  // 14  0011.\r\n\t\t  -1, 19*3,     0,  // 15  00000\r\n\t\t   0,    0,  0x01,  // 16  00011.\r\n\t\t20*3, 21*3,     0,  // 17  00001\r\n\t\t   0,    0,  0x1e,  // 18  00010.\r\n\t\t   0,    0,  0x11,  // 19  000001.\r\n\t\t   0,    0,  0x16,  // 20  000010.\r\n\t\t   0,    0,  0x1a   // 21  000011.\r\n\t]),\r\n\t\r\n\tCODE_BLOCK_PATTERN = new Int16Array([\r\n\t\t  2*3,   1*3,   0,  //   0\r\n\t\t  3*3,   6*3,   0,  //   1  1\r\n\t\t  4*3,   5*3,   0,  //   2  0\r\n\t\t  8*3,  11*3,   0,  //   3  10\r\n\t\t 12*3,  13*3,   0,  //   4  00\r\n\t\t  9*3,   7*3,   0,  //   5  01\r\n\t\t 10*3,  14*3,   0,  //   6  11\r\n\t\t 20*3,  19*3,   0,  //   7  011\r\n\t\t 18*3,  16*3,   0,  //   8  100\r\n\t\t 23*3,  17*3,   0,  //   9  010\r\n\t\t 27*3,  25*3,   0,  //  10  110\r\n\t\t 21*3,  28*3,   0,  //  11  101\r\n\t\t 15*3,  22*3,   0,  //  12  000\r\n\t\t 24*3,  26*3,   0,  //  13  001\r\n\t\t    0,     0,  60,  //  14  111.\r\n\t\t 35*3,  40*3,   0,  //  15  0000\r\n\t\t 44*3,  48*3,   0,  //  16  1001\r\n\t\t 38*3,  36*3,   0,  //  17  0101\r\n\t\t 42*3,  47*3,   0,  //  18  1000\r\n\t\t 29*3,  31*3,   0,  //  19  0111\r\n\t\t 39*3,  32*3,   0,  //  20  0110\r\n\t\t    0,     0,  32,  //  21  1010.\r\n\t\t 45*3,  46*3,   0,  //  22  0001\r\n\t\t 33*3,  41*3,   0,  //  23  0100\r\n\t\t 43*3,  34*3,   0,  //  24  0010\r\n\t\t    0,     0,   4,  //  25  1101.\r\n\t\t 30*3,  37*3,   0,  //  26  0011\r\n\t\t    0,     0,   8,  //  27  1100.\r\n\t\t    0,     0,  16,  //  28  1011.\r\n\t\t    0,     0,  44,  //  29  0111 0.\r\n\t\t 50*3,  56*3,   0,  //  30  0011 0\r\n\t\t    0,     0,  28,  //  31  0111 1.\r\n\t\t    0,     0,  52,  //  32  0110 1.\r\n\t\t    0,     0,  62,  //  33  0100 0.\r\n\t\t 61*3,  59*3,   0,  //  34  0010 1\r\n\t\t 52*3,  60*3,   0,  //  35  0000 0\r\n\t\t    0,     0,   1,  //  36  0101 1.\r\n\t\t 55*3,  54*3,   0,  //  37  0011 1\r\n\t\t    0,     0,  61,  //  38  0101 0.\r\n\t\t    0,     0,  56,  //  39  0110 0.\r\n\t\t 57*3,  58*3,   0,  //  40  0000 1\r\n\t\t    0,     0,   2,  //  41  0100 1.\r\n\t\t    0,     0,  40,  //  42  1000 0.\r\n\t\t 51*3,  62*3,   0,  //  43  0010 0\r\n\t\t    0,     0,  48,  //  44  1001 0.\r\n\t\t 64*3,  63*3,   0,  //  45  0001 0\r\n\t\t 49*3,  53*3,   0,  //  46  0001 1\r\n\t\t    0,     0,  20,  //  47  1000 1.\r\n\t\t    0,     0,  12,  //  48  1001 1.\r\n\t\t 80*3,  83*3,   0,  //  49  0001 10\r\n\t\t    0,     0,  63,  //  50  0011 00.\r\n\t\t 77*3,  75*3,   0,  //  51  0010 00\r\n\t\t 65*3,  73*3,   0,  //  52  0000 00\r\n\t\t 84*3,  66*3,   0,  //  53  0001 11\r\n\t\t    0,     0,  24,  //  54  0011 11.\r\n\t\t    0,     0,  36,  //  55  0011 10.\r\n\t\t    0,     0,   3,  //  56  0011 01.\r\n\t\t 69*3,  87*3,   0,  //  57  0000 10\r\n\t\t 81*3,  79*3,   0,  //  58  0000 11\r\n\t\t 68*3,  71*3,   0,  //  59  0010 11\r\n\t\t 70*3,  78*3,   0,  //  60  0000 01\r\n\t\t 67*3,  76*3,   0,  //  61  0010 10\r\n\t\t 72*3,  74*3,   0,  //  62  0010 01\r\n\t\t 86*3,  85*3,   0,  //  63  0001 01\r\n\t\t 88*3,  82*3,   0,  //  64  0001 00\r\n\t\t   -1,  94*3,   0,  //  65  0000 000\r\n\t\t 95*3,  97*3,   0,  //  66  0001 111\r\n\t\t    0,     0,  33,  //  67  0010 100.\r\n\t\t    0,     0,   9,  //  68  0010 110.\r\n\t\t106*3, 110*3,   0,  //  69  0000 100\r\n\t\t102*3, 116*3,   0,  //  70  0000 010\r\n\t\t    0,     0,   5,  //  71  0010 111.\r\n\t\t    0,     0,  10,  //  72  0010 010.\r\n\t\t 93*3,  89*3,   0,  //  73  0000 001\r\n\t\t    0,     0,   6,  //  74  0010 011.\r\n\t\t    0,     0,  18,  //  75  0010 001.\r\n\t\t    0,     0,  17,  //  76  0010 101.\r\n\t\t    0,     0,  34,  //  77  0010 000.\r\n\t\t113*3, 119*3,   0,  //  78  0000 011\r\n\t\t103*3, 104*3,   0,  //  79  0000 111\r\n\t\t 90*3,  92*3,   0,  //  80  0001 100\r\n\t\t109*3, 107*3,   0,  //  81  0000 110\r\n\t\t117*3, 118*3,   0,  //  82  0001 001\r\n\t\t101*3,  99*3,   0,  //  83  0001 101\r\n\t\t 98*3,  96*3,   0,  //  84  0001 110\r\n\t\t100*3,  91*3,   0,  //  85  0001 011\r\n\t\t114*3, 115*3,   0,  //  86  0001 010\r\n\t\t105*3, 108*3,   0,  //  87  0000 101\r\n\t\t112*3, 111*3,   0,  //  88  0001 000\r\n\t\t121*3, 125*3,   0,  //  89  0000 0011\r\n\t\t    0,     0,  41,  //  90  0001 1000.\r\n\t\t    0,     0,  14,  //  91  0001 0111.\r\n\t\t    0,     0,  21,  //  92  0001 1001.\r\n\t\t124*3, 122*3,   0,  //  93  0000 0010\r\n\t\t120*3, 123*3,   0,  //  94  0000 0001\r\n\t\t    0,     0,  11,  //  95  0001 1110.\r\n\t\t    0,     0,  19,  //  96  0001 1101.\r\n\t\t    0,     0,   7,  //  97  0001 1111.\r\n\t\t    0,     0,  35,  //  98  0001 1100.\r\n\t\t    0,     0,  13,  //  99  0001 1011.\r\n\t\t    0,     0,  50,  // 100  0001 0110.\r\n\t\t    0,     0,  49,  // 101  0001 1010.\r\n\t\t    0,     0,  58,  // 102  0000 0100.\r\n\t\t    0,     0,  37,  // 103  0000 1110.\r\n\t\t    0,     0,  25,  // 104  0000 1111.\r\n\t\t    0,     0,  45,  // 105  0000 1010.\r\n\t\t    0,     0,  57,  // 106  0000 1000.\r\n\t\t    0,     0,  26,  // 107  0000 1101.\r\n\t\t    0,     0,  29,  // 108  0000 1011.\r\n\t\t    0,     0,  38,  // 109  0000 1100.\r\n\t\t    0,     0,  53,  // 110  0000 1001.\r\n\t\t    0,     0,  23,  // 111  0001 0001.\r\n\t\t    0,     0,  43,  // 112  0001 0000.\r\n\t\t    0,     0,  46,  // 113  0000 0110.\r\n\t\t    0,     0,  42,  // 114  0001 0100.\r\n\t\t    0,     0,  22,  // 115  0001 0101.\r\n\t\t    0,     0,  54,  // 116  0000 0101.\r\n\t\t    0,     0,  51,  // 117  0001 0010.\r\n\t\t    0,     0,  15,  // 118  0001 0011.\r\n\t\t    0,     0,  30,  // 119  0000 0111.\r\n\t\t    0,     0,  39,  // 120  0000 0001 0.\r\n\t\t    0,     0,  47,  // 121  0000 0011 0.\r\n\t\t    0,     0,  55,  // 122  0000 0010 1.\r\n\t\t    0,     0,  27,  // 123  0000 0001 1.\r\n\t\t    0,     0,  59,  // 124  0000 0010 0.\r\n\t\t    0,     0,  31   // 125  0000 0011 1.\r\n\t]),\r\n\t\r\n\tMOTION = new Int16Array([\r\n\t\t  1*3,   2*3,   0,  //   0\r\n\t\t  4*3,   3*3,   0,  //   1  0\r\n\t\t    0,     0,   0,  //   2  1.\r\n\t\t  6*3,   5*3,   0,  //   3  01\r\n\t\t  8*3,   7*3,   0,  //   4  00\r\n\t\t    0,     0,  -1,  //   5  011.\r\n\t\t    0,     0,   1,  //   6  010.\r\n\t\t  9*3,  10*3,   0,  //   7  001\r\n\t\t 12*3,  11*3,   0,  //   8  000\r\n\t\t    0,     0,   2,  //   9  0010.\r\n\t\t    0,     0,  -2,  //  10  0011.\r\n\t\t 14*3,  15*3,   0,  //  11  0001\r\n\t\t 16*3,  13*3,   0,  //  12  0000\r\n\t\t 20*3,  18*3,   0,  //  13  0000 1\r\n\t\t    0,     0,   3,  //  14  0001 0.\r\n\t\t    0,     0,  -3,  //  15  0001 1.\r\n\t\t 17*3,  19*3,   0,  //  16  0000 0\r\n\t\t   -1,  23*3,   0,  //  17  0000 00\r\n\t\t 27*3,  25*3,   0,  //  18  0000 11\r\n\t\t 26*3,  21*3,   0,  //  19  0000 01\r\n\t\t 24*3,  22*3,   0,  //  20  0000 10\r\n\t\t 32*3,  28*3,   0,  //  21  0000 011\r\n\t\t 29*3,  31*3,   0,  //  22  0000 101\r\n\t\t   -1,  33*3,   0,  //  23  0000 001\r\n\t\t 36*3,  35*3,   0,  //  24  0000 100\r\n\t\t    0,     0,  -4,  //  25  0000 111.\r\n\t\t 30*3,  34*3,   0,  //  26  0000 010\r\n\t\t    0,     0,   4,  //  27  0000 110.\r\n\t\t    0,     0,  -7,  //  28  0000 0111.\r\n\t\t    0,     0,   5,  //  29  0000 1010.\r\n\t\t 37*3,  41*3,   0,  //  30  0000 0100\r\n\t\t    0,     0,  -5,  //  31  0000 1011.\r\n\t\t    0,     0,   7,  //  32  0000 0110.\r\n\t\t 38*3,  40*3,   0,  //  33  0000 0011\r\n\t\t 42*3,  39*3,   0,  //  34  0000 0101\r\n\t\t    0,     0,  -6,  //  35  0000 1001.\r\n\t\t    0,     0,   6,  //  36  0000 1000.\r\n\t\t 51*3,  54*3,   0,  //  37  0000 0100 0\r\n\t\t 50*3,  49*3,   0,  //  38  0000 0011 0\r\n\t\t 45*3,  46*3,   0,  //  39  0000 0101 1\r\n\t\t 52*3,  47*3,   0,  //  40  0000 0011 1\r\n\t\t 43*3,  53*3,   0,  //  41  0000 0100 1\r\n\t\t 44*3,  48*3,   0,  //  42  0000 0101 0\r\n\t\t    0,     0,  10,  //  43  0000 0100 10.\r\n\t\t    0,     0,   9,  //  44  0000 0101 00.\r\n\t\t    0,     0,   8,  //  45  0000 0101 10.\r\n\t\t    0,     0,  -8,  //  46  0000 0101 11.\r\n\t\t 57*3,  66*3,   0,  //  47  0000 0011 11\r\n\t\t    0,     0,  -9,  //  48  0000 0101 01.\r\n\t\t 60*3,  64*3,   0,  //  49  0000 0011 01\r\n\t\t 56*3,  61*3,   0,  //  50  0000 0011 00\r\n\t\t 55*3,  62*3,   0,  //  51  0000 0100 00\r\n\t\t 58*3,  63*3,   0,  //  52  0000 0011 10\r\n\t\t    0,     0, -10,  //  53  0000 0100 11.\r\n\t\t 59*3,  65*3,   0,  //  54  0000 0100 01\r\n\t\t    0,     0,  12,  //  55  0000 0100 000.\r\n\t\t    0,     0,  16,  //  56  0000 0011 000.\r\n\t\t    0,     0,  13,  //  57  0000 0011 110.\r\n\t\t    0,     0,  14,  //  58  0000 0011 100.\r\n\t\t    0,     0,  11,  //  59  0000 0100 010.\r\n\t\t    0,     0,  15,  //  60  0000 0011 010.\r\n\t\t    0,     0, -16,  //  61  0000 0011 001.\r\n\t\t    0,     0, -12,  //  62  0000 0100 001.\r\n\t\t    0,     0, -14,  //  63  0000 0011 101.\r\n\t\t    0,     0, -15,  //  64  0000 0011 011.\r\n\t\t    0,     0, -11,  //  65  0000 0100 011.\r\n\t\t    0,     0, -13   //  66  0000 0011 111.\r\n\t]),\r\n\t\r\n\tDCT_DC_SIZE_LUMINANCE = new Int8Array([\r\n\t\t  2*3,   1*3, 0,  //   0\r\n\t\t  6*3,   5*3, 0,  //   1  1\r\n\t\t  3*3,   4*3, 0,  //   2  0\r\n\t\t    0,     0, 1,  //   3  00.\r\n\t\t    0,     0, 2,  //   4  01.\r\n\t\t  9*3,   8*3, 0,  //   5  11\r\n\t\t  7*3,  10*3, 0,  //   6  10\r\n\t\t    0,     0, 0,  //   7  100.\r\n\t\t 12*3,  11*3, 0,  //   8  111\r\n\t\t    0,     0, 4,  //   9  110.\r\n\t\t    0,     0, 3,  //  10  101.\r\n\t\t 13*3,  14*3, 0,  //  11  1111\r\n\t\t    0,     0, 5,  //  12  1110.\r\n\t\t    0,     0, 6,  //  13  1111 0.\r\n\t\t 16*3,  15*3, 0,  //  14  1111 1\r\n\t\t 17*3,    -1, 0,  //  15  1111 11\r\n\t\t    0,     0, 7,  //  16  1111 10.\r\n\t\t    0,     0, 8   //  17  1111 110.\r\n\t]),\r\n\t\r\n\tDCT_DC_SIZE_CHROMINANCE = new Int8Array([\r\n\t\t  2*3,   1*3, 0,  //   0\r\n\t\t  4*3,   3*3, 0,  //   1  1\r\n\t\t  6*3,   5*3, 0,  //   2  0\r\n\t\t  8*3,   7*3, 0,  //   3  11\r\n\t\t    0,     0, 2,  //   4  10.\r\n\t\t    0,     0, 1,  //   5  01.\r\n\t\t    0,     0, 0,  //   6  00.\r\n\t\t 10*3,   9*3, 0,  //   7  111\r\n\t\t    0,     0, 3,  //   8  110.\r\n\t\t 12*3,  11*3, 0,  //   9  1111\r\n\t\t    0,     0, 4,  //  10  1110.\r\n\t\t 14*3,  13*3, 0,  //  11  1111 1\r\n\t\t    0,     0, 5,  //  12  1111 0.\r\n\t\t 16*3,  15*3, 0,  //  13  1111 11\r\n\t\t    0,     0, 6,  //  14  1111 10.\r\n\t\t 17*3,    -1, 0,  //  15  1111 111\r\n\t\t    0,     0, 7,  //  16  1111 110.\r\n\t\t    0,     0, 8   //  17  1111 1110.\r\n\t]),\r\n\t\r\n\t//  dct_coeff bitmap:\r\n\t//    0xff00  run\r\n\t//    0x00ff  level\r\n\t\r\n\t//  Decoded values are unsigned. Sign bit follows in the stream.\r\n\t\r\n\t//  Interpretation of the value 0x0001\r\n\t//    for dc_coeff_first:  run=0, level=1\r\n\t//    for dc_coeff_next:   If the next bit is 1: run=0, level=1\r\n\t//                         If the next bit is 0: end_of_block\r\n\t\r\n\t//  escape decodes as 0xffff.\r\n\t\r\n\tDCT_COEFF = new Int32Array([\r\n\t\t  1*3,   2*3,      0,  //   0\r\n\t\t  4*3,   3*3,      0,  //   1  0\r\n\t\t    0,     0, 0x0001,  //   2  1.\r\n\t\t  7*3,   8*3,      0,  //   3  01\r\n\t\t  6*3,   5*3,      0,  //   4  00\r\n\t\t 13*3,   9*3,      0,  //   5  001\r\n\t\t 11*3,  10*3,      0,  //   6  000\r\n\t\t 14*3,  12*3,      0,  //   7  010\r\n\t\t    0,     0, 0x0101,  //   8  011.\r\n\t\t 20*3,  22*3,      0,  //   9  0011\r\n\t\t 18*3,  21*3,      0,  //  10  0001\r\n\t\t 16*3,  19*3,      0,  //  11  0000\r\n\t\t    0,     0, 0x0201,  //  12  0101.\r\n\t\t 17*3,  15*3,      0,  //  13  0010\r\n\t\t    0,     0, 0x0002,  //  14  0100.\r\n\t\t    0,     0, 0x0003,  //  15  0010 1.\r\n\t\t 27*3,  25*3,      0,  //  16  0000 0\r\n\t\t 29*3,  31*3,      0,  //  17  0010 0\r\n\t\t 24*3,  26*3,      0,  //  18  0001 0\r\n\t\t 32*3,  30*3,      0,  //  19  0000 1\r\n\t\t    0,     0, 0x0401,  //  20  0011 0.\r\n\t\t 23*3,  28*3,      0,  //  21  0001 1\r\n\t\t    0,     0, 0x0301,  //  22  0011 1.\r\n\t\t    0,     0, 0x0102,  //  23  0001 10.\r\n\t\t    0,     0, 0x0701,  //  24  0001 00.\r\n\t\t    0,     0, 0xffff,  //  25  0000 01. -- escape\r\n\t\t    0,     0, 0x0601,  //  26  0001 01.\r\n\t\t 37*3,  36*3,      0,  //  27  0000 00\r\n\t\t    0,     0, 0x0501,  //  28  0001 11.\r\n\t\t 35*3,  34*3,      0,  //  29  0010 00\r\n\t\t 39*3,  38*3,      0,  //  30  0000 11\r\n\t\t 33*3,  42*3,      0,  //  31  0010 01\r\n\t\t 40*3,  41*3,      0,  //  32  0000 10\r\n\t\t 52*3,  50*3,      0,  //  33  0010 010\r\n\t\t 54*3,  53*3,      0,  //  34  0010 001\r\n\t\t 48*3,  49*3,      0,  //  35  0010 000\r\n\t\t 43*3,  45*3,      0,  //  36  0000 001\r\n\t\t 46*3,  44*3,      0,  //  37  0000 000\r\n\t\t    0,     0, 0x0801,  //  38  0000 111.\r\n\t\t    0,     0, 0x0004,  //  39  0000 110.\r\n\t\t    0,     0, 0x0202,  //  40  0000 100.\r\n\t\t    0,     0, 0x0901,  //  41  0000 101.\r\n\t\t 51*3,  47*3,      0,  //  42  0010 011\r\n\t\t 55*3,  57*3,      0,  //  43  0000 0010\r\n\t\t 60*3,  56*3,      0,  //  44  0000 0001\r\n\t\t 59*3,  58*3,      0,  //  45  0000 0011\r\n\t\t 61*3,  62*3,      0,  //  46  0000 0000\r\n\t\t    0,     0, 0x0a01,  //  47  0010 0111.\r\n\t\t    0,     0, 0x0d01,  //  48  0010 0000.\r\n\t\t    0,     0, 0x0006,  //  49  0010 0001.\r\n\t\t    0,     0, 0x0103,  //  50  0010 0101.\r\n\t\t    0,     0, 0x0005,  //  51  0010 0110.\r\n\t\t    0,     0, 0x0302,  //  52  0010 0100.\r\n\t\t    0,     0, 0x0b01,  //  53  0010 0011.\r\n\t\t    0,     0, 0x0c01,  //  54  0010 0010.\r\n\t\t 76*3,  75*3,      0,  //  55  0000 0010 0\r\n\t\t 67*3,  70*3,      0,  //  56  0000 0001 1\r\n\t\t 73*3,  71*3,      0,  //  57  0000 0010 1\r\n\t\t 78*3,  74*3,      0,  //  58  0000 0011 1\r\n\t\t 72*3,  77*3,      0,  //  59  0000 0011 0\r\n\t\t 69*3,  64*3,      0,  //  60  0000 0001 0\r\n\t\t 68*3,  63*3,      0,  //  61  0000 0000 0\r\n\t\t 66*3,  65*3,      0,  //  62  0000 0000 1\r\n\t\t 81*3,  87*3,      0,  //  63  0000 0000 01\r\n\t\t 91*3,  80*3,      0,  //  64  0000 0001 01\r\n\t\t 82*3,  79*3,      0,  //  65  0000 0000 11\r\n\t\t 83*3,  86*3,      0,  //  66  0000 0000 10\r\n\t\t 93*3,  92*3,      0,  //  67  0000 0001 10\r\n\t\t 84*3,  85*3,      0,  //  68  0000 0000 00\r\n\t\t 90*3,  94*3,      0,  //  69  0000 0001 00\r\n\t\t 88*3,  89*3,      0,  //  70  0000 0001 11\r\n\t\t    0,     0, 0x0203,  //  71  0000 0010 11.\r\n\t\t    0,     0, 0x0104,  //  72  0000 0011 00.\r\n\t\t    0,     0, 0x0007,  //  73  0000 0010 10.\r\n\t\t    0,     0, 0x0402,  //  74  0000 0011 11.\r\n\t\t    0,     0, 0x0502,  //  75  0000 0010 01.\r\n\t\t    0,     0, 0x1001,  //  76  0000 0010 00.\r\n\t\t    0,     0, 0x0f01,  //  77  0000 0011 01.\r\n\t\t    0,     0, 0x0e01,  //  78  0000 0011 10.\r\n\t\t105*3, 107*3,      0,  //  79  0000 0000 111\r\n\t\t111*3, 114*3,      0,  //  80  0000 0001 011\r\n\t\t104*3,  97*3,      0,  //  81  0000 0000 010\r\n\t\t125*3, 119*3,      0,  //  82  0000 0000 110\r\n\t\t 96*3,  98*3,      0,  //  83  0000 0000 100\r\n\t\t   -1, 123*3,      0,  //  84  0000 0000 000\r\n\t\t 95*3, 101*3,      0,  //  85  0000 0000 001\r\n\t\t106*3, 121*3,      0,  //  86  0000 0000 101\r\n\t\t 99*3, 102*3,      0,  //  87  0000 0000 011\r\n\t\t113*3, 103*3,      0,  //  88  0000 0001 110\r\n\t\t112*3, 116*3,      0,  //  89  0000 0001 111\r\n\t\t110*3, 100*3,      0,  //  90  0000 0001 000\r\n\t\t124*3, 115*3,      0,  //  91  0000 0001 010\r\n\t\t117*3, 122*3,      0,  //  92  0000 0001 101\r\n\t\t109*3, 118*3,      0,  //  93  0000 0001 100\r\n\t\t120*3, 108*3,      0,  //  94  0000 0001 001\r\n\t\t127*3, 136*3,      0,  //  95  0000 0000 0010\r\n\t\t139*3, 140*3,      0,  //  96  0000 0000 1000\r\n\t\t130*3, 126*3,      0,  //  97  0000 0000 0101\r\n\t\t145*3, 146*3,      0,  //  98  0000 0000 1001\r\n\t\t128*3, 129*3,      0,  //  99  0000 0000 0110\r\n\t\t    0,     0, 0x0802,  // 100  0000 0001 0001.\r\n\t\t132*3, 134*3,      0,  // 101  0000 0000 0011\r\n\t\t155*3, 154*3,      0,  // 102  0000 0000 0111\r\n\t\t    0,     0, 0x0008,  // 103  0000 0001 1101.\r\n\t\t137*3, 133*3,      0,  // 104  0000 0000 0100\r\n\t\t143*3, 144*3,      0,  // 105  0000 0000 1110\r\n\t\t151*3, 138*3,      0,  // 106  0000 0000 1010\r\n\t\t142*3, 141*3,      0,  // 107  0000 0000 1111\r\n\t\t    0,     0, 0x000a,  // 108  0000 0001 0011.\r\n\t\t    0,     0, 0x0009,  // 109  0000 0001 1000.\r\n\t\t    0,     0, 0x000b,  // 110  0000 0001 0000.\r\n\t\t    0,     0, 0x1501,  // 111  0000 0001 0110.\r\n\t\t    0,     0, 0x0602,  // 112  0000 0001 1110.\r\n\t\t    0,     0, 0x0303,  // 113  0000 0001 1100.\r\n\t\t    0,     0, 0x1401,  // 114  0000 0001 0111.\r\n\t\t    0,     0, 0x0702,  // 115  0000 0001 0101.\r\n\t\t    0,     0, 0x1101,  // 116  0000 0001 1111.\r\n\t\t    0,     0, 0x1201,  // 117  0000 0001 1010.\r\n\t\t    0,     0, 0x1301,  // 118  0000 0001 1001.\r\n\t\t148*3, 152*3,      0,  // 119  0000 0000 1101\r\n\t\t    0,     0, 0x0403,  // 120  0000 0001 0010.\r\n\t\t153*3, 150*3,      0,  // 121  0000 0000 1011\r\n\t\t    0,     0, 0x0105,  // 122  0000 0001 1011.\r\n\t\t131*3, 135*3,      0,  // 123  0000 0000 0001\r\n\t\t    0,     0, 0x0204,  // 124  0000 0001 0100.\r\n\t\t149*3, 147*3,      0,  // 125  0000 0000 1100\r\n\t\t172*3, 173*3,      0,  // 126  0000 0000 0101 1\r\n\t\t162*3, 158*3,      0,  // 127  0000 0000 0010 0\r\n\t\t170*3, 161*3,      0,  // 128  0000 0000 0110 0\r\n\t\t168*3, 166*3,      0,  // 129  0000 0000 0110 1\r\n\t\t157*3, 179*3,      0,  // 130  0000 0000 0101 0\r\n\t\t169*3, 167*3,      0,  // 131  0000 0000 0001 0\r\n\t\t174*3, 171*3,      0,  // 132  0000 0000 0011 0\r\n\t\t178*3, 177*3,      0,  // 133  0000 0000 0100 1\r\n\t\t156*3, 159*3,      0,  // 134  0000 0000 0011 1\r\n\t\t164*3, 165*3,      0,  // 135  0000 0000 0001 1\r\n\t\t183*3, 182*3,      0,  // 136  0000 0000 0010 1\r\n\t\t175*3, 176*3,      0,  // 137  0000 0000 0100 0\r\n\t\t    0,     0, 0x0107,  // 138  0000 0000 1010 1.\r\n\t\t    0,     0, 0x0a02,  // 139  0000 0000 1000 0.\r\n\t\t    0,     0, 0x0902,  // 140  0000 0000 1000 1.\r\n\t\t    0,     0, 0x1601,  // 141  0000 0000 1111 1.\r\n\t\t    0,     0, 0x1701,  // 142  0000 0000 1111 0.\r\n\t\t    0,     0, 0x1901,  // 143  0000 0000 1110 0.\r\n\t\t    0,     0, 0x1801,  // 144  0000 0000 1110 1.\r\n\t\t    0,     0, 0x0503,  // 145  0000 0000 1001 0.\r\n\t\t    0,     0, 0x0304,  // 146  0000 0000 1001 1.\r\n\t\t    0,     0, 0x000d,  // 147  0000 0000 1100 1.\r\n\t\t    0,     0, 0x000c,  // 148  0000 0000 1101 0.\r\n\t\t    0,     0, 0x000e,  // 149  0000 0000 1100 0.\r\n\t\t    0,     0, 0x000f,  // 150  0000 0000 1011 1.\r\n\t\t    0,     0, 0x0205,  // 151  0000 0000 1010 0.\r\n\t\t    0,     0, 0x1a01,  // 152  0000 0000 1101 1.\r\n\t\t    0,     0, 0x0106,  // 153  0000 0000 1011 0.\r\n\t\t180*3, 181*3,      0,  // 154  0000 0000 0111 1\r\n\t\t160*3, 163*3,      0,  // 155  0000 0000 0111 0\r\n\t\t196*3, 199*3,      0,  // 156  0000 0000 0011 10\r\n\t\t    0,     0, 0x001b,  // 157  0000 0000 0101 00.\r\n\t\t203*3, 185*3,      0,  // 158  0000 0000 0010 01\r\n\t\t202*3, 201*3,      0,  // 159  0000 0000 0011 11\r\n\t\t    0,     0, 0x0013,  // 160  0000 0000 0111 00.\r\n\t\t    0,     0, 0x0016,  // 161  0000 0000 0110 01.\r\n\t\t197*3, 207*3,      0,  // 162  0000 0000 0010 00\r\n\t\t    0,     0, 0x0012,  // 163  0000 0000 0111 01.\r\n\t\t191*3, 192*3,      0,  // 164  0000 0000 0001 10\r\n\t\t188*3, 190*3,      0,  // 165  0000 0000 0001 11\r\n\t\t    0,     0, 0x0014,  // 166  0000 0000 0110 11.\r\n\t\t184*3, 194*3,      0,  // 167  0000 0000 0001 01\r\n\t\t    0,     0, 0x0015,  // 168  0000 0000 0110 10.\r\n\t\t186*3, 193*3,      0,  // 169  0000 0000 0001 00\r\n\t\t    0,     0, 0x0017,  // 170  0000 0000 0110 00.\r\n\t\t204*3, 198*3,      0,  // 171  0000 0000 0011 01\r\n\t\t    0,     0, 0x0019,  // 172  0000 0000 0101 10.\r\n\t\t    0,     0, 0x0018,  // 173  0000 0000 0101 11.\r\n\t\t200*3, 205*3,      0,  // 174  0000 0000 0011 00\r\n\t\t    0,     0, 0x001f,  // 175  0000 0000 0100 00.\r\n\t\t    0,     0, 0x001e,  // 176  0000 0000 0100 01.\r\n\t\t    0,     0, 0x001c,  // 177  0000 0000 0100 11.\r\n\t\t    0,     0, 0x001d,  // 178  0000 0000 0100 10.\r\n\t\t    0,     0, 0x001a,  // 179  0000 0000 0101 01.\r\n\t\t    0,     0, 0x0011,  // 180  0000 0000 0111 10.\r\n\t\t    0,     0, 0x0010,  // 181  0000 0000 0111 11.\r\n\t\t189*3, 206*3,      0,  // 182  0000 0000 0010 11\r\n\t\t187*3, 195*3,      0,  // 183  0000 0000 0010 10\r\n\t\t218*3, 211*3,      0,  // 184  0000 0000 0001 010\r\n\t\t    0,     0, 0x0025,  // 185  0000 0000 0010 011.\r\n\t\t215*3, 216*3,      0,  // 186  0000 0000 0001 000\r\n\t\t    0,     0, 0x0024,  // 187  0000 0000 0010 100.\r\n\t\t210*3, 212*3,      0,  // 188  0000 0000 0001 110\r\n\t\t    0,     0, 0x0022,  // 189  0000 0000 0010 110.\r\n\t\t213*3, 209*3,      0,  // 190  0000 0000 0001 111\r\n\t\t221*3, 222*3,      0,  // 191  0000 0000 0001 100\r\n\t\t219*3, 208*3,      0,  // 192  0000 0000 0001 101\r\n\t\t217*3, 214*3,      0,  // 193  0000 0000 0001 001\r\n\t\t223*3, 220*3,      0,  // 194  0000 0000 0001 011\r\n\t\t    0,     0, 0x0023,  // 195  0000 0000 0010 101.\r\n\t\t    0,     0, 0x010b,  // 196  0000 0000 0011 100.\r\n\t\t    0,     0, 0x0028,  // 197  0000 0000 0010 000.\r\n\t\t    0,     0, 0x010c,  // 198  0000 0000 0011 011.\r\n\t\t    0,     0, 0x010a,  // 199  0000 0000 0011 101.\r\n\t\t    0,     0, 0x0020,  // 200  0000 0000 0011 000.\r\n\t\t    0,     0, 0x0108,  // 201  0000 0000 0011 111.\r\n\t\t    0,     0, 0x0109,  // 202  0000 0000 0011 110.\r\n\t\t    0,     0, 0x0026,  // 203  0000 0000 0010 010.\r\n\t\t    0,     0, 0x010d,  // 204  0000 0000 0011 010.\r\n\t\t    0,     0, 0x010e,  // 205  0000 0000 0011 001.\r\n\t\t    0,     0, 0x0021,  // 206  0000 0000 0010 111.\r\n\t\t    0,     0, 0x0027,  // 207  0000 0000 0010 001.\r\n\t\t    0,     0, 0x1f01,  // 208  0000 0000 0001 1011.\r\n\t\t    0,     0, 0x1b01,  // 209  0000 0000 0001 1111.\r\n\t\t    0,     0, 0x1e01,  // 210  0000 0000 0001 1100.\r\n\t\t    0,     0, 0x1002,  // 211  0000 0000 0001 0101.\r\n\t\t    0,     0, 0x1d01,  // 212  0000 0000 0001 1101.\r\n\t\t    0,     0, 0x1c01,  // 213  0000 0000 0001 1110.\r\n\t\t    0,     0, 0x010f,  // 214  0000 0000 0001 0011.\r\n\t\t    0,     0, 0x0112,  // 215  0000 0000 0001 0000.\r\n\t\t    0,     0, 0x0111,  // 216  0000 0000 0001 0001.\r\n\t\t    0,     0, 0x0110,  // 217  0000 0000 0001 0010.\r\n\t\t    0,     0, 0x0603,  // 218  0000 0000 0001 0100.\r\n\t\t    0,     0, 0x0b02,  // 219  0000 0000 0001 1010.\r\n\t\t    0,     0, 0x0e02,  // 220  0000 0000 0001 0111.\r\n\t\t    0,     0, 0x0d02,  // 221  0000 0000 0001 1000.\r\n\t\t    0,     0, 0x0c02,  // 222  0000 0000 0001 1001.\r\n\t\t    0,     0, 0x0f02   // 223  0000 0000 0001 0110.\r\n\t]),\r\n\t\r\n\tPICTURE_TYPE_I = 1,\r\n\tPICTURE_TYPE_P = 2,\r\n\tPICTURE_TYPE_B = 3,\r\n\tPICTURE_TYPE_D = 4,\r\n\t\r\n\tSTART_SEQUENCE = 0xB3,\r\n\tSTART_SLICE_FIRST = 0x01,\r\n\tSTART_SLICE_LAST = 0xAF,\r\n\tSTART_PICTURE = 0x00,\r\n\tSTART_EXTENSION = 0xB5,\r\n\tSTART_USER_DATA = 0xB2;\r\n\t\r\nvar MACROBLOCK_TYPE_TABLES = [\r\n\tnull,\r\n\tMACROBLOCK_TYPE_I,\r\n\tMACROBLOCK_TYPE_P,\r\n\tMACROBLOCK_TYPE_B\r\n];\r\n\r\n\r\n\r\n// ----------------------------------------------------------------------------\r\n// Bit Reader \r\n\r\nvar BitReader = function(arrayBuffer) {\r\n\tthis.bytes = new Uint8Array(arrayBuffer);\r\n\tthis.length = this.bytes.length;\r\n\tthis.writePos = this.bytes.length;\r\n\tthis.index = 0;\r\n};\r\n\r\nBitReader.NOT_FOUND = -1;\r\n\r\nBitReader.prototype.findNextMPEGStartCode = function() {\t\r\n\tfor( var i = (this.index+7 >> 3); i < this.writePos; i++ ) {\r\n\t\tif(\r\n\t\t\tthis.bytes[i] == 0x00 &&\r\n\t\t\tthis.bytes[i+1] == 0x00 &&\r\n\t\t\tthis.bytes[i+2] == 0x01\r\n\t\t) {\r\n\t\t\tthis.index = (i+4) << 3;\r\n\t\t\treturn this.bytes[i+3];\r\n\t\t}\r\n\t}\r\n\tthis.index = (this.writePos << 3);\r\n\treturn BitReader.NOT_FOUND;\r\n};\r\n\r\nBitReader.prototype.nextBytesAreStartCode = function() {\r\n\tvar i = (this.index+7 >> 3);\r\n\treturn (\r\n\t\ti >= this.writePos || (\r\n\t\t\tthis.bytes[i] == 0x00 && \r\n\t\t\tthis.bytes[i+1] == 0x00 &&\r\n\t\t\tthis.bytes[i+2] == 0x01\r\n\t\t)\r\n\t);\r\n};\r\n\r\nBitReader.prototype.nextBits = function(count) {\r\n\tvar \r\n\t\tbyteOffset = this.index >> 3,\r\n\t\troom = (8 - this.index % 8);\r\n\r\n\tif( room >= count ) {\r\n\t\treturn (this.bytes[byteOffset] >> (room - count)) & (0xff >> (8-count));\r\n\t}\r\n\r\n\tvar \r\n\t\tleftover = (this.index + count) % 8, // Leftover bits in last byte\r\n\t\tend = (this.index + count -1) >> 3,\r\n\t\tvalue = this.bytes[byteOffset] & (0xff >> (8-room)); // Fill out first byte\r\n\r\n\tfor( byteOffset++; byteOffset < end; byteOffset++ ) {\r\n\t\tvalue <<= 8; // Shift and\r\n\t\tvalue |= this.bytes[byteOffset]; // Put next byte\r\n\t}\r\n\r\n\tif (leftover > 0) {\r\n\t\tvalue <<= leftover; // Make room for remaining bits\r\n\t\tvalue |= (this.bytes[byteOffset] >> (8 - leftover));\r\n\t}\r\n\telse {\r\n\t\tvalue <<= 8;\r\n\t\tvalue |= this.bytes[byteOffset];\r\n\t}\r\n\t\r\n\treturn value;\r\n};\r\n\r\nBitReader.prototype.getBits = function(count) {\r\n\tvar value = this.nextBits(count);\r\n\tthis.index += count;\r\n\treturn value;\r\n};\r\n\r\nBitReader.prototype.advance = function(count) {\r\n\treturn (this.index += count);\r\n};\r\n\r\nBitReader.prototype.rewind = function(count) {\r\n\treturn (this.index -= count);\r\n};\r\n\t\r\n})(window);\r\n\r\n","/*!\r\n * Bootstrap v3.1.1 (http://getbootstrap.com)\r\n * Copyright 2011-2014 Twitter, Inc.\r\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)\r\n */\r\nif(\"undefined\"==typeof jQuery)throw new Error(\"Bootstrap's JavaScript requires jQuery\");+function(a){\"use strict\";function b(){var a=document.createElement(\"bootstrap\"),b={WebkitTransition:\"webkitTransitionEnd\",MozTransition:\"transitionend\",OTransition:\"oTransitionEnd otransitionend\",transition:\"transitionend\"};for(var c in b)if(void 0!==a.style[c])return{end:b[c]};return!1}a.fn.emulateTransitionEnd=function(b){var c=!1,d=this;a(this).one(a.support.transition.end,function(){c=!0});var e=function(){c||a(d).trigger(a.support.transition.end)};return setTimeout(e,b),this},a(function(){a.support.transition=b()})}(jQuery),+function(a){\"use strict\";var b='[data-dismiss=\"alert\"]',c=function(c){a(c).on(\"click\",b,this.close)};c.prototype.close=function(b){function c(){f.trigger(\"closed.bs.alert\").remove()}var d=a(this),e=d.attr(\"data-target\");e||(e=d.attr(\"href\"),e=e&&e.replace(/.*(?=#[^\\s]*$)/,\"\"));var f=a(e);b&&b.preventDefault(),f.length||(f=d.hasClass(\"alert\")?d:d.parent()),f.trigger(b=a.Event(\"close.bs.alert\")),b.isDefaultPrevented()||(f.removeClass(\"in\"),a.support.transition&&f.hasClass(\"fade\")?f.one(a.support.transition.end,c).emulateTransitionEnd(150):c())};var d=a.fn.alert;a.fn.alert=function(b){return this.each(function(){var d=a(this),e=d.data(\"bs.alert\");e||d.data(\"bs.alert\",e=new c(this)),\"string\"==typeof b&&e[b].call(d)})},a.fn.alert.Constructor=c,a.fn.alert.noConflict=function(){return a.fn.alert=d,this},a(document).on(\"click.bs.alert.data-api\",b,c.prototype.close)}(jQuery),+function(a){\"use strict\";var b=function(c,d){this.$element=a(c),this.options=a.extend({},b.DEFAULTS,d),this.isLoading=!1};b.DEFAULTS={loadingText:\"loading...\"},b.prototype.setState=function(b){var c=\"disabled\",d=this.$element,e=d.is(\"input\")?\"val\":\"html\",f=d.data();b+=\"Text\",f.resetText||d.data(\"resetText\",d[e]()),d[e](f[b]||this.options[b]),setTimeout(a.proxy(function(){\"loadingText\"==b?(this.isLoading=!0,d.addClass(c).attr(c,c)):this.isLoading&&(this.isLoading=!1,d.removeClass(c).removeAttr(c))},this),0)},b.prototype.toggle=function(){var a=!0,b=this.$element.closest('[data-toggle=\"buttons\"]');if(b.length){var c=this.$element.find(\"input\");\"radio\"==c.prop(\"type\")&&(c.prop(\"checked\")&&this.$element.hasClass(\"active\")?a=!1:b.find(\".active\").removeClass(\"active\")),a&&c.prop(\"checked\",!this.$element.hasClass(\"active\")).trigger(\"change\")}a&&this.$element.toggleClass(\"active\")};var c=a.fn.button;a.fn.button=function(c){return this.each(function(){var d=a(this),e=d.data(\"bs.button\"),f=\"object\"==typeof c&&c;e||d.data(\"bs.button\",e=new b(this,f)),\"toggle\"==c?e.toggle():c&&e.setState(c)})},a.fn.button.Constructor=b,a.fn.button.noConflict=function(){return a.fn.button=c,this},a(document).on(\"click.bs.button.data-api\",\"[data-toggle^=button]\",function(b){var c=a(b.target);c.hasClass(\"btn\")||(c=c.closest(\".btn\")),c.button(\"toggle\"),b.preventDefault()})}(jQuery),+function(a){\"use strict\";var b=function(b,c){this.$element=a(b),this.$indicators=this.$element.find(\".carousel-indicators\"),this.options=c,this.paused=this.sliding=this.interval=this.$active=this.$items=null,\"hover\"==this.options.pause&&this.$element.on(\"mouseenter\",a.proxy(this.pause,this)).on(\"mouseleave\",a.proxy(this.cycle,this))};b.DEFAULTS={interval:5e3,pause:\"hover\",wrap:!0},b.prototype.cycle=function(b){return b||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(a.proxy(this.next,this),this.options.interval)),this},b.prototype.getActiveIndex=function(){return this.$active=this.$element.find(\".item.active\"),this.$items=this.$active.parent().children(),this.$items.index(this.$active)},b.prototype.to=function(b){var c=this,d=this.getActiveIndex();return b>this.$items.length-1||0>b?void 0:this.sliding?this.$element.one(\"slid.bs.carousel\",function(){c.to(b)}):d==b?this.pause().cycle():this.slide(b>d?\"next\":\"prev\",a(this.$items[b]))},b.prototype.pause=function(b){return b||(this.paused=!0),this.$element.find(\".next, .prev\").length&&a.support.transition&&(this.$element.trigger(a.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},b.prototype.next=function(){return this.sliding?void 0:this.slide(\"next\")},b.prototype.prev=function(){return this.sliding?void 0:this.slide(\"prev\")},b.prototype.slide=function(b,c){var d=this.$element.find(\".item.active\"),e=c||d[b](),f=this.interval,g=\"next\"==b?\"left\":\"right\",h=\"next\"==b?\"first\":\"last\",i=this;if(!e.length){if(!this.options.wrap)return;e=this.$element.find(\".item\")[h]()}if(e.hasClass(\"active\"))return this.sliding=!1;var j=a.Event(\"slide.bs.carousel\",{relatedTarget:e[0],direction:g});return this.$element.trigger(j),j.isDefaultPrevented()?void 0:(this.sliding=!0,f&&this.pause(),this.$indicators.length&&(this.$indicators.find(\".active\").removeClass(\"active\"),this.$element.one(\"slid.bs.carousel\",function(){var b=a(i.$indicators.children()[i.getActiveIndex()]);b&&b.addClass(\"active\")})),a.support.transition&&this.$element.hasClass(\"slide\")?(e.addClass(b),e[0].offsetWidth,d.addClass(g),e.addClass(g),d.one(a.support.transition.end,function(){e.removeClass([b,g].join(\" \")).addClass(\"active\"),d.removeClass([\"active\",g].join(\" \")),i.sliding=!1,setTimeout(function(){i.$element.trigger(\"slid.bs.carousel\")},0)}).emulateTransitionEnd(1e3*d.css(\"transition-duration\").slice(0,-1))):(d.removeClass(\"active\"),e.addClass(\"active\"),this.sliding=!1,this.$element.trigger(\"slid.bs.carousel\")),f&&this.cycle(),this)};var c=a.fn.carousel;a.fn.carousel=function(c){return this.each(function(){var d=a(this),e=d.data(\"bs.carousel\"),f=a.extend({},b.DEFAULTS,d.data(),\"object\"==typeof c&&c),g=\"string\"==typeof c?c:f.slide;e||d.data(\"bs.carousel\",e=new b(this,f)),\"number\"==typeof c?e.to(c):g?e[g]():f.interval&&e.pause().cycle()})},a.fn.carousel.Constructor=b,a.fn.carousel.noConflict=function(){return a.fn.carousel=c,this},a(document).on(\"click.bs.carousel.data-api\",\"[data-slide], [data-slide-to]\",function(b){var c,d=a(this),e=a(d.attr(\"data-target\")||(c=d.attr(\"href\"))&&c.replace(/.*(?=#[^\\s]+$)/,\"\")),f=a.extend({},e.data(),d.data()),g=d.attr(\"data-slide-to\");g&&(f.interval=!1),e.carousel(f),(g=d.attr(\"data-slide-to\"))&&e.data(\"bs.carousel\").to(g),b.preventDefault()}),a(window).on(\"load\",function(){a('[data-ride=\"carousel\"]').each(function(){var b=a(this);b.carousel(b.data())})})}(jQuery),+function(a){\"use strict\";var b=function(c,d){this.$element=a(c),this.options=a.extend({},b.DEFAULTS,d),this.transitioning=null,this.options.parent&&(this.$parent=a(this.options.parent)),this.options.toggle&&this.toggle()};b.DEFAULTS={toggle:!0},b.prototype.dimension=function(){var a=this.$element.hasClass(\"width\");return a?\"width\":\"height\"},b.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass(\"in\")){var b=a.Event(\"show.bs.collapse\");if(this.$element.trigger(b),!b.isDefaultPrevented()){var c=this.$parent&&this.$parent.find(\"> .panel > .in\");if(c&&c.length){var d=c.data(\"bs.collapse\");if(d&&d.transitioning)return;c.collapse(\"hide\"),d||c.data(\"bs.collapse\",null)}var e=this.dimension();this.$element.removeClass(\"collapse\").addClass(\"collapsing\")[e](0),this.transitioning=1;var f=function(){this.$element.removeClass(\"collapsing\").addClass(\"collapse in\")[e](\"auto\"),this.transitioning=0,this.$element.trigger(\"shown.bs.collapse\")};if(!a.support.transition)return f.call(this);var g=a.camelCase([\"scroll\",e].join(\"-\"));this.$element.one(a.support.transition.end,a.proxy(f,this)).emulateTransitionEnd(350)[e](this.$element[0][g])}}},b.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass(\"in\")){var b=a.Event(\"hide.bs.collapse\");if(this.$element.trigger(b),!b.isDefaultPrevented()){var c=this.dimension();this.$element[c](this.$element[c]())[0].offsetHeight,this.$element.addClass(\"collapsing\").removeClass(\"collapse\").removeClass(\"in\"),this.transitioning=1;var d=function(){this.transitioning=0,this.$element.trigger(\"hidden.bs.collapse\").removeClass(\"collapsing\").addClass(\"collapse\")};return a.support.transition?void this.$element[c](0).one(a.support.transition.end,a.proxy(d,this)).emulateTransitionEnd(350):d.call(this)}}},b.prototype.toggle=function(){this[this.$element.hasClass(\"in\")?\"hide\":\"show\"]()};var c=a.fn.collapse;a.fn.collapse=function(c){return this.each(function(){var d=a(this),e=d.data(\"bs.collapse\"),f=a.extend({},b.DEFAULTS,d.data(),\"object\"==typeof c&&c);!e&&f.toggle&&\"show\"==c&&(c=!c),e||d.data(\"bs.collapse\",e=new b(this,f)),\"string\"==typeof c&&e[c]()})},a.fn.collapse.Constructor=b,a.fn.collapse.noConflict=function(){return a.fn.collapse=c,this},a(document).on(\"click.bs.collapse.data-api\",\"[data-toggle=collapse]\",function(b){var c,d=a(this),e=d.attr(\"data-target\")||b.preventDefault()||(c=d.attr(\"href\"))&&c.replace(/.*(?=#[^\\s]+$)/,\"\"),f=a(e),g=f.data(\"bs.collapse\"),h=g?\"toggle\":d.data(),i=d.attr(\"data-parent\"),j=i&&a(i);g&&g.transitioning||(j&&j.find('[data-toggle=collapse][data-parent=\"'+i+'\"]').not(d).addClass(\"collapsed\"),d[f.hasClass(\"in\")?\"addClass\":\"removeClass\"](\"collapsed\")),f.collapse(h)})}(jQuery),+function(a){\"use strict\";function b(b){a(d).remove(),a(e).each(function(){var d=c(a(this)),e={relatedTarget:this};d.hasClass(\"open\")&&(d.trigger(b=a.Event(\"hide.bs.dropdown\",e)),b.isDefaultPrevented()||d.removeClass(\"open\").trigger(\"hidden.bs.dropdown\",e))})}function c(b){var c=b.attr(\"data-target\");c||(c=b.attr(\"href\"),c=c&&/#[A-Za-z]/.test(c)&&c.replace(/.*(?=#[^\\s]*$)/,\"\"));var d=c&&a(c);return d&&d.length?d:b.parent()}var d=\".dropdown-backdrop\",e=\"[data-toggle=dropdown]\",f=function(b){a(b).on(\"click.bs.dropdown\",this.toggle)};f.prototype.toggle=function(d){var e=a(this);if(!e.is(\".disabled, :disabled\")){var f=c(e),g=f.hasClass(\"open\");if(b(),!g){\"ontouchstart\"in document.documentElement&&!f.closest(\".navbar-nav\").length&&a('<div class=\"dropdown-backdrop\"/>').insertAfter(a(this)).on(\"click\",b);var h={relatedTarget:this};if(f.trigger(d=a.Event(\"show.bs.dropdown\",h)),d.isDefaultPrevented())return;f.toggleClass(\"open\").trigger(\"shown.bs.dropdown\",h),e.focus()}return!1}},f.prototype.keydown=function(b){if(/(38|40|27)/.test(b.keyCode)){var d=a(this);if(b.preventDefault(),b.stopPropagation(),!d.is(\".disabled, :disabled\")){var f=c(d),g=f.hasClass(\"open\");if(!g||g&&27==b.keyCode)return 27==b.which&&f.find(e).focus(),d.click();var h=\" li:not(.divider):visible a\",i=f.find(\"[role=menu]\"+h+\", [role=listbox]\"+h);if(i.length){var j=i.index(i.filter(\":focus\"));38==b.keyCode&&j>0&&j--,40==b.keyCode&&j<i.length-1&&j++,~j||(j=0),i.eq(j).focus()}}}};var g=a.fn.dropdown;a.fn.dropdown=function(b){return this.each(function(){var c=a(this),d=c.data(\"bs.dropdown\");d||c.data(\"bs.dropdown\",d=new f(this)),\"string\"==typeof b&&d[b].call(c)})},a.fn.dropdown.Constructor=f,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=g,this},a(document).on(\"click.bs.dropdown.data-api\",b).on(\"click.bs.dropdown.data-api\",\".dropdown form\",function(a){a.stopPropagation()}).on(\"click.bs.dropdown.data-api\",e,f.prototype.toggle).on(\"keydown.bs.dropdown.data-api\",e+\", [role=menu], [role=listbox]\",f.prototype.keydown)}(jQuery),+function(a){\"use strict\";var b=function(b,c){this.options=c,this.$element=a(b),this.$backdrop=this.isShown=null,this.options.remote&&this.$element.find(\".modal-content\").load(this.options.remote,a.proxy(function(){this.$element.trigger(\"loaded.bs.modal\")},this))};b.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},b.prototype.toggle=function(a){return this[this.isShown?\"hide\":\"show\"](a)},b.prototype.show=function(b){var c=this,d=a.Event(\"show.bs.modal\",{relatedTarget:b});this.$element.trigger(d),this.isShown||d.isDefaultPrevented()||(this.isShown=!0,this.escape(),this.$element.on(\"click.dismiss.bs.modal\",'[data-dismiss=\"modal\"]',a.proxy(this.hide,this)),this.backdrop(function(){var d=a.support.transition&&c.$element.hasClass(\"fade\");c.$element.parent().length||c.$element.appendTo(document.body),c.$element.show().scrollTop(0),d&&c.$element[0].offsetWidth,c.$element.addClass(\"in\").attr(\"aria-hidden\",!1),c.enforceFocus();var e=a.Event(\"shown.bs.modal\",{relatedTarget:b});d?c.$element.find(\".modal-dialog\").one(a.support.transition.end,function(){c.$element.focus().trigger(e)}).emulateTransitionEnd(300):c.$element.focus().trigger(e)}))},b.prototype.hide=function(b){b&&b.preventDefault(),b=a.Event(\"hide.bs.modal\"),this.$element.trigger(b),this.isShown&&!b.isDefaultPrevented()&&(this.isShown=!1,this.escape(),a(document).off(\"focusin.bs.modal\"),this.$element.removeClass(\"in\").attr(\"aria-hidden\",!0).off(\"click.dismiss.bs.modal\"),a.support.transition&&this.$element.hasClass(\"fade\")?this.$element.one(a.support.transition.end,a.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal())},b.prototype.enforceFocus=function(){a(document).off(\"focusin.bs.modal\").on(\"focusin.bs.modal\",a.proxy(function(a){this.$element[0]===a.target||this.$element.has(a.target).length||this.$element.focus()},this))},b.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on(\"keyup.dismiss.bs.modal\",a.proxy(function(a){27==a.which&&this.hide()},this)):this.isShown||this.$element.off(\"keyup.dismiss.bs.modal\")},b.prototype.hideModal=function(){var a=this;this.$element.hide(),this.backdrop(function(){a.removeBackdrop(),a.$element.trigger(\"hidden.bs.modal\")})},b.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},b.prototype.backdrop=function(b){var c=this.$element.hasClass(\"fade\")?\"fade\":\"\";if(this.isShown&&this.options.backdrop){var d=a.support.transition&&c;if(this.$backdrop=a('<div class=\"modal-backdrop '+c+'\" />').appendTo(document.body),this.$element.on(\"click.dismiss.bs.modal\",a.proxy(function(a){a.target===a.currentTarget&&(\"static\"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),d&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass(\"in\"),!b)return;d?this.$backdrop.one(a.support.transition.end,b).emulateTransitionEnd(150):b()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass(\"in\"),a.support.transition&&this.$element.hasClass(\"fade\")?this.$backdrop.one(a.support.transition.end,b).emulateTransitionEnd(150):b()):b&&b()};var c=a.fn.modal;a.fn.modal=function(c,d){return this.each(function(){var e=a(this),f=e.data(\"bs.modal\"),g=a.extend({},b.DEFAULTS,e.data(),\"object\"==typeof c&&c);f||e.data(\"bs.modal\",f=new b(this,g)),\"string\"==typeof c?f[c](d):g.show&&f.show(d)})},a.fn.modal.Constructor=b,a.fn.modal.noConflict=function(){return a.fn.modal=c,this},a(document).on(\"click.bs.modal.data-api\",'[data-toggle=\"modal\"]',function(b){var c=a(this),d=c.attr(\"href\"),e=a(c.attr(\"data-target\")||d&&d.replace(/.*(?=#[^\\s]+$)/,\"\")),f=e.data(\"bs.modal\")?\"toggle\":a.extend({remote:!/#/.test(d)&&d},e.data(),c.data());c.is(\"a\")&&b.preventDefault(),e.modal(f,this).one(\"hide\",function(){c.is(\":visible\")&&c.focus()})}),a(document).on(\"show.bs.modal\",\".modal\",function(){a(document.body).addClass(\"modal-open\")}).on(\"hidden.bs.modal\",\".modal\",function(){a(document.body).removeClass(\"modal-open\")})}(jQuery),+function(a){\"use strict\";var b=function(a,b){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init(\"tooltip\",a,b)};b.DEFAULTS={animation:!0,placement:\"top\",selector:!1,template:'<div class=\"tooltip\"><div class=\"tooltip-arrow\"></div><div class=\"tooltip-inner\"></div></div>',trigger:\"hover focus\",title:\"\",delay:0,html:!1,container:!1},b.prototype.init=function(b,c,d){this.enabled=!0,this.type=b,this.$element=a(c),this.options=this.getOptions(d);for(var e=this.options.trigger.split(\" \"),f=e.length;f--;){var g=e[f];if(\"click\"==g)this.$element.on(\"click.\"+this.type,this.options.selector,a.proxy(this.toggle,this));else if(\"manual\"!=g){var h=\"hover\"==g?\"mouseenter\":\"focusin\",i=\"hover\"==g?\"mouseleave\":\"focusout\";this.$element.on(h+\".\"+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(i+\".\"+this.type,this.options.selector,a.proxy(this.leave,this))}}this.options.selector?this._options=a.extend({},this.options,{trigger:\"manual\",selector:\"\"}):this.fixTitle()},b.prototype.getDefaults=function(){return b.DEFAULTS},b.prototype.getOptions=function(b){return b=a.extend({},this.getDefaults(),this.$element.data(),b),b.delay&&\"number\"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},b.prototype.getDelegateOptions=function(){var b={},c=this.getDefaults();return this._options&&a.each(this._options,function(a,d){c[a]!=d&&(b[a]=d)}),b},b.prototype.enter=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget)[this.type](this.getDelegateOptions()).data(\"bs.\"+this.type);return clearTimeout(c.timeout),c.hoverState=\"in\",c.options.delay&&c.options.delay.show?void(c.timeout=setTimeout(function(){\"in\"==c.hoverState&&c.show()},c.options.delay.show)):c.show()},b.prototype.leave=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget)[this.type](this.getDelegateOptions()).data(\"bs.\"+this.type);return clearTimeout(c.timeout),c.hoverState=\"out\",c.options.delay&&c.options.delay.hide?void(c.timeout=setTimeout(function(){\"out\"==c.hoverState&&c.hide()},c.options.delay.hide)):c.hide()},b.prototype.show=function(){var b=a.Event(\"show.bs.\"+this.type);if(this.hasContent()&&this.enabled){if(this.$element.trigger(b),b.isDefaultPrevented())return;var c=this,d=this.tip();this.setContent(),this.options.animation&&d.addClass(\"fade\");var e=\"function\"==typeof this.options.placement?this.options.placement.call(this,d[0],this.$element[0]):this.options.placement,f=/\\s?auto?\\s?/i,g=f.test(e);g&&(e=e.replace(f,\"\")||\"top\"),d.detach().css({top:0,left:0,display:\"block\"}).addClass(e),this.options.container?d.appendTo(this.options.container):d.insertAfter(this.$element);var h=this.getPosition(),i=d[0].offsetWidth,j=d[0].offsetHeight;if(g){var k=this.$element.parent(),l=e,m=document.documentElement.scrollTop||document.body.scrollTop,n=\"body\"==this.options.container?window.innerWidth:k.outerWidth(),o=\"body\"==this.options.container?window.innerHeight:k.outerHeight(),p=\"body\"==this.options.container?0:k.offset().left;e=\"bottom\"==e&&h.top+h.height+j-m>o?\"top\":\"top\"==e&&h.top-m-j<0?\"bottom\":\"right\"==e&&h.right+i>n?\"left\":\"left\"==e&&h.left-i<p?\"right\":e,d.removeClass(l).addClass(e)}var q=this.getCalculatedOffset(e,h,i,j);this.applyPlacement(q,e),this.hoverState=null;var r=function(){c.$element.trigger(\"shown.bs.\"+c.type)};a.support.transition&&this.$tip.hasClass(\"fade\")?d.one(a.support.transition.end,r).emulateTransitionEnd(150):r()}},b.prototype.applyPlacement=function(b,c){var d,e=this.tip(),f=e[0].offsetWidth,g=e[0].offsetHeight,h=parseInt(e.css(\"margin-top\"),10),i=parseInt(e.css(\"margin-left\"),10);isNaN(h)&&(h=0),isNaN(i)&&(i=0),b.top=b.top+h,b.left=b.left+i,a.offset.setOffset(e[0],a.extend({using:function(a){e.css({top:Math.round(a.top),left:Math.round(a.left)})}},b),0),e.addClass(\"in\");var j=e[0].offsetWidth,k=e[0].offsetHeight;if(\"top\"==c&&k!=g&&(d=!0,b.top=b.top+g-k),/bottom|top/.test(c)){var l=0;b.left<0&&(l=-2*b.left,b.left=0,e.offset(b),j=e[0].offsetWidth,k=e[0].offsetHeight),this.replaceArrow(l-f+j,j,\"left\")}else this.replaceArrow(k-g,k,\"top\");d&&e.offset(b)},b.prototype.replaceArrow=function(a,b,c){this.arrow().css(c,a?50*(1-a/b)+\"%\":\"\")},b.prototype.setContent=function(){var a=this.tip(),b=this.getTitle();a.find(\".tooltip-inner\")[this.options.html?\"html\":\"text\"](b),a.removeClass(\"fade in top bottom left right\")},b.prototype.hide=function(){function b(){\"in\"!=c.hoverState&&d.detach(),c.$element.trigger(\"hidden.bs.\"+c.type)}var c=this,d=this.tip(),e=a.Event(\"hide.bs.\"+this.type);return this.$element.trigger(e),e.isDefaultPrevented()?void 0:(d.removeClass(\"in\"),a.support.transition&&this.$tip.hasClass(\"fade\")?d.one(a.support.transition.end,b).emulateTransitionEnd(150):b(),this.hoverState=null,this)},b.prototype.fixTitle=function(){var a=this.$element;(a.attr(\"title\")||\"string\"!=typeof a.attr(\"data-original-title\"))&&a.attr(\"data-original-title\",a.attr(\"title\")||\"\").attr(\"title\",\"\")},b.prototype.hasContent=function(){return this.getTitle()},b.prototype.getPosition=function(){var b=this.$element[0];return a.extend({},\"function\"==typeof b.getBoundingClientRect?b.getBoundingClientRect():{width:b.offsetWidth,height:b.offsetHeight},this.$element.offset())},b.prototype.getCalculatedOffset=function(a,b,c,d){return\"bottom\"==a?{top:b.top+b.height,left:b.left+b.width/2-c/2}:\"top\"==a?{top:b.top-d,left:b.left+b.width/2-c/2}:\"left\"==a?{top:b.top+b.height/2-d/2,left:b.left-c}:{top:b.top+b.height/2-d/2,left:b.left+b.width}},b.prototype.getTitle=function(){var a,b=this.$element,c=this.options;return a=b.attr(\"data-original-title\")||(\"function\"==typeof c.title?c.title.call(b[0]):c.title)},b.prototype.tip=function(){return this.$tip=this.$tip||a(this.options.template)},b.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(\".tooltip-arrow\")},b.prototype.validate=function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},b.prototype.enable=function(){this.enabled=!0},b.prototype.disable=function(){this.enabled=!1},b.prototype.toggleEnabled=function(){this.enabled=!this.enabled},b.prototype.toggle=function(b){var c=b?a(b.currentTarget)[this.type](this.getDelegateOptions()).data(\"bs.\"+this.type):this;c.tip().hasClass(\"in\")?c.leave(c):c.enter(c)},b.prototype.destroy=function(){clearTimeout(this.timeout),this.hide().$element.off(\".\"+this.type).removeData(\"bs.\"+this.type)};var c=a.fn.tooltip;a.fn.tooltip=function(c){return this.each(function(){var d=a(this),e=d.data(\"bs.tooltip\"),f=\"object\"==typeof c&&c;(e||\"destroy\"!=c)&&(e||d.data(\"bs.tooltip\",e=new b(this,f)),\"string\"==typeof c&&e[c]())})},a.fn.tooltip.Constructor=b,a.fn.tooltip.noConflict=function(){return a.fn.tooltip=c,this}}(jQuery),+function(a){\"use strict\";var b=function(a,b){this.init(\"popover\",a,b)};if(!a.fn.tooltip)throw new Error(\"Popover requires tooltip.js\");b.DEFAULTS=a.extend({},a.fn.tooltip.Constructor.DEFAULTS,{placement:\"right\",trigger:\"click\",content:\"\",template:'<div class=\"popover\"><div class=\"arrow\"></div><h3 class=\"popover-title\"></h3><div class=\"popover-content\"></div></div>'}),b.prototype=a.extend({},a.fn.tooltip.Constructor.prototype),b.prototype.constructor=b,b.prototype.getDefaults=function(){return b.DEFAULTS},b.prototype.setContent=function(){var a=this.tip(),b=this.getTitle(),c=this.getContent();a.find(\".popover-title\")[this.options.html?\"html\":\"text\"](b),a.find(\".popover-content\")[this.options.html?\"string\"==typeof c?\"html\":\"append\":\"text\"](c),a.removeClass(\"fade top bottom left right in\"),a.find(\".popover-title\").html()||a.find(\".popover-title\").hide()},b.prototype.hasContent=function(){return this.getTitle()||this.getContent()},b.prototype.getContent=function(){var a=this.$element,b=this.options;return a.attr(\"data-content\")||(\"function\"==typeof b.content?b.content.call(a[0]):b.content)},b.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(\".arrow\")},b.prototype.tip=function(){return this.$tip||(this.$tip=a(this.options.template)),this.$tip};var c=a.fn.popover;a.fn.popover=function(c){return this.each(function(){var d=a(this),e=d.data(\"bs.popover\"),f=\"object\"==typeof c&&c;(e||\"destroy\"!=c)&&(e||d.data(\"bs.popover\",e=new b(this,f)),\"string\"==typeof c&&e[c]())})},a.fn.popover.Constructor=b,a.fn.popover.noConflict=function(){return a.fn.popover=c,this}}(jQuery),+function(a){\"use strict\";function b(c,d){var e,f=a.proxy(this.process,this);this.$element=a(a(c).is(\"body\")?window:c),this.$body=a(\"body\"),this.$scrollElement=this.$element.on(\"scroll.bs.scroll-spy.data-api\",f),this.options=a.extend({},b.DEFAULTS,d),this.selector=(this.options.target||(e=a(c).attr(\"href\"))&&e.replace(/.*(?=#[^\\s]+$)/,\"\")||\"\")+\" .nav li > a\",this.offsets=a([]),this.targets=a([]),this.activeTarget=null,this.refresh(),this.process()}b.DEFAULTS={offset:10},b.prototype.refresh=function(){var b=this.$element[0]==window?\"offset\":\"position\";this.offsets=a([]),this.targets=a([]);{var c=this;this.$body.find(this.selector).map(function(){var d=a(this),e=d.data(\"target\")||d.attr(\"href\"),f=/^#./.test(e)&&a(e);return f&&f.length&&f.is(\":visible\")&&[[f[b]().top+(!a.isWindow(c.$scrollElement.get(0))&&c.$scrollElement.scrollTop()),e]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){c.offsets.push(this[0]),c.targets.push(this[1])})}},b.prototype.process=function(){var a,b=this.$scrollElement.scrollTop()+this.options.offset,c=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,d=c-this.$scrollElement.height(),e=this.offsets,f=this.targets,g=this.activeTarget;if(b>=d)return g!=(a=f.last()[0])&&this.activate(a);if(g&&b<=e[0])return g!=(a=f[0])&&this.activate(a);for(a=e.length;a--;)g!=f[a]&&b>=e[a]&&(!e[a+1]||b<=e[a+1])&&this.activate(f[a])},b.prototype.activate=function(b){this.activeTarget=b,a(this.selector).parentsUntil(this.options.target,\".active\").removeClass(\"active\");var c=this.selector+'[data-target=\"'+b+'\"],'+this.selector+'[href=\"'+b+'\"]',d=a(c).parents(\"li\").addClass(\"active\");d.parent(\".dropdown-menu\").length&&(d=d.closest(\"li.dropdown\").addClass(\"active\")),d.trigger(\"activate.bs.scrollspy\")};var c=a.fn.scrollspy;a.fn.scrollspy=function(c){return this.each(function(){var d=a(this),e=d.data(\"bs.scrollspy\"),f=\"object\"==typeof c&&c;e||d.data(\"bs.scrollspy\",e=new b(this,f)),\"string\"==typeof c&&e[c]()})},a.fn.scrollspy.Constructor=b,a.fn.scrollspy.noConflict=function(){return a.fn.scrollspy=c,this},a(window).on(\"load\",function(){a('[data-spy=\"scroll\"]').each(function(){var b=a(this);b.scrollspy(b.data())})})}(jQuery),+function(a){\"use strict\";var b=function(b){this.element=a(b)};b.prototype.show=function(){var b=this.element,c=b.closest(\"ul:not(.dropdown-menu)\"),d=b.data(\"target\");if(d||(d=b.attr(\"href\"),d=d&&d.replace(/.*(?=#[^\\s]*$)/,\"\")),!b.parent(\"li\").hasClass(\"active\")){var e=c.find(\".active:last a\")[0],f=a.Event(\"show.bs.tab\",{relatedTarget:e});if(b.trigger(f),!f.isDefaultPrevented()){var g=a(d);this.activate(b.parent(\"li\"),c),this.activate(g,g.parent(),function(){b.trigger({type:\"shown.bs.tab\",relatedTarget:e})})}}},b.prototype.activate=function(b,c,d){function e(){f.removeClass(\"active\").find(\"> .dropdown-menu > .active\").removeClass(\"active\"),b.addClass(\"active\"),g?(b[0].offsetWidth,b.addClass(\"in\")):b.removeClass(\"fade\"),b.parent(\".dropdown-menu\")&&b.closest(\"li.dropdown\").addClass(\"active\"),d&&d()}var f=c.find(\"> .active\"),g=d&&a.support.transition&&f.hasClass(\"fade\");g?f.one(a.support.transition.end,e).emulateTransitionEnd(150):e(),f.removeClass(\"in\")};var c=a.fn.tab;a.fn.tab=function(c){return this.each(function(){var d=a(this),e=d.data(\"bs.tab\");e||d.data(\"bs.tab\",e=new b(this)),\"string\"==typeof c&&e[c]()})},a.fn.tab.Constructor=b,a.fn.tab.noConflict=function(){return a.fn.tab=c,this},a(document).on(\"click.bs.tab.data-api\",'[data-toggle=\"tab\"], [data-toggle=\"pill\"]',function(b){b.preventDefault(),a(this).tab(\"show\")})}(jQuery),+function(a){\"use strict\";var b=function(c,d){this.options=a.extend({},b.DEFAULTS,d),this.$window=a(window).on(\"scroll.bs.affix.data-api\",a.proxy(this.checkPosition,this)).on(\"click.bs.affix.data-api\",a.proxy(this.checkPositionWithEventLoop,this)),this.$element=a(c),this.affixed=this.unpin=this.pinnedOffset=null,this.checkPosition()};b.RESET=\"affix affix-top affix-bottom\",b.DEFAULTS={offset:0},b.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(b.RESET).addClass(\"affix\");var a=this.$window.scrollTop(),c=this.$element.offset();return this.pinnedOffset=c.top-a},b.prototype.checkPositionWithEventLoop=function(){setTimeout(a.proxy(this.checkPosition,this),1)},b.prototype.checkPosition=function(){if(this.$element.is(\":visible\")){var c=a(document).height(),d=this.$window.scrollTop(),e=this.$element.offset(),f=this.options.offset,g=f.top,h=f.bottom;\"top\"==this.affixed&&(e.top+=d),\"object\"!=typeof f&&(h=g=f),\"function\"==typeof g&&(g=f.top(this.$element)),\"function\"==typeof h&&(h=f.bottom(this.$element));var i=null!=this.unpin&&d+this.unpin<=e.top?!1:null!=h&&e.top+this.$element.height()>=c-h?\"bottom\":null!=g&&g>=d?\"top\":!1;if(this.affixed!==i){this.unpin&&this.$element.css(\"top\",\"\");var j=\"affix\"+(i?\"-\"+i:\"\"),k=a.Event(j+\".bs.affix\");this.$element.trigger(k),k.isDefaultPrevented()||(this.affixed=i,this.unpin=\"bottom\"==i?this.getPinnedOffset():null,this.$element.removeClass(b.RESET).addClass(j).trigger(a.Event(j.replace(\"affix\",\"affixed\"))),\"bottom\"==i&&this.$element.offset({top:c-h-this.$element.height()}))}}};var c=a.fn.affix;a.fn.affix=function(c){return this.each(function(){var d=a(this),e=d.data(\"bs.affix\"),f=\"object\"==typeof c&&c;e||d.data(\"bs.affix\",e=new b(this,f)),\"string\"==typeof c&&e[c]()})},a.fn.affix.Constructor=b,a.fn.affix.noConflict=function(){return a.fn.affix=c,this},a(window).on(\"load\",function(){a('[data-spy=\"affix\"]').each(function(){var b=a(this),c=b.data();c.offset=c.offset||{},c.offsetBottom&&(c.offset.bottom=c.offsetBottom),c.offsetTop&&(c.offset.top=c.offsetTop),b.affix(c)})})}(jQuery);","Storage = require \"storage\"\r\n\r\n# The application object.\r\nmodule.exports = class Application extends Chaplin.Application\r\n  start: ->\r\n\r\n    # Get auth state from the server\r\n    $.get \"/api/auth\", (data) =>\r\n      if data.auth\r\n        Storage.user = data.user\r\n\r\n      super\r\n","Shot = require \"models/shot\"\r\n\r\nmodule.exports = class ShotsCollection extends Chaplin.Collection\r\n  model : Shot\r\n  url : \"/api/shots\"\r\n\r\n  forceLoad : ->\r\n    $.get(\"#{@url}/load\")\r\n    .done =>\r\n      do @fetch\r\n    .fail =>\r\n\r\n","Station = require \"models/station\"\r\n\r\nmodule.exports = class StationCollection extends Chaplin.Collection\r\n  _.extend @prototype, Chaplin.SyncMachine\r\n  \r\n  model : Station\r\n  url : \"/api/stations\"\r\n","Storage = require \"storage\"\r\n\r\nBaseController = require \"controllers/base/baseController\"\r\n\r\nmodule.exports = class AuthController extends BaseController\r\n  beforeAction: (params, route) ->\r\n    super\r\n    if not Storage.user?\r\n      Storage.redirectUrl = window.location.pathname\r\n      @redirectTo 'auth_login'\r\n\r\n","LoginView = require \"views/auth/loginView\"\r\nSiteView = require \"views/site/siteView\"\r\n\r\nStorage = require \"storage\"\r\n\r\nBaseController = require \"controllers/base/baseController\"\r\n\r\nmodule.exports = class LoginController extends BaseController\r\n  login : ->\r\n    @view = new LoginView\r\n      region : \"main\"\r\n      autoRender : true\r\n\r\n  logout : ->\r\n    $.post(\"/api/auth/logout\")\r\n    .then =>\r\n      Storage.user = null\r\n      Chaplin.mediator.publish 'loginState', null\r\n      @redirectTo \"static#about\"\r\n","AuthController    = require \"./authController\"\r\n\r\nStation           = require \"models/station\"\r\nStationEditView   = require \"views/station/edit/stationEditView\"\r\nStationCreateView = require \"views/station/create/stationCreateView\" \r\nStationRenameView = require \"views/station/rename/stationRenameView\"\r\n\r\nSiteView        = require \"views/site/siteView\"\r\n\r\nmodule.exports = class stationAuthController extends AuthController\r\n  beforeAction : ->\r\n    super\r\n    # Site view declares “main” region.\r\n    @reuse 'site', SiteView\r\n\r\n  edit : (params) ->\r\n    @model = new Station\r\n      name : params.name\r\n\r\n    @view = new StationEditView\r\n      model : @model\r\n      region : \"main\"\r\n\r\n    @model.fetch().then =>\r\n      do @view.render\r\n\r\n  create : (params) ->\r\n    @view = new StationCreateView\r\n      region : \"main\"\r\n      autoRender : true\r\n\r\n  rename : (params) ->\r\n    @model = new Station\r\n      name : params.name\r\n\r\n    @view = new StationRenameView\r\n      model : @model\r\n      region : \"main\"\r\n\r\n    @model.fetch().then =>\r\n      do @view.render\r\n","SiteView = require \"views/site/siteView\"\r\nHeaderView = require \"views/site/header/headerView\"\r\n\r\nmodule.exports = class BaseController extends Chaplin.Controller\r\n  beforeAction : ->\r\n    super\r\n    @reuse 'site', SiteView\r\n    @reuse 'header', HeaderView, region: 'header'\r\n\r\n","SiteView = require \"views/site/siteView\"\r\n\r\nShot = require \"models/shot\"\r\n\r\n# ShotView = require \"views/shot/shotView\"\r\nShotCollection = require \"collections/shotCollection\"\r\nShotGridView   = require \"views/shot/grid/shotGridView\"\r\nShotView       = require \"views/shot/show/shotView\"\r\n\r\nBaseController = require \"controllers/base/baseController\"\r\n\r\nmodule.exports = class ShotsController extends BaseController\r\n  beforeAction : ->\r\n    super\r\n\r\n  index : ->\r\n    @collection = new ShotCollection\r\n    @view = new ShotGridView\r\n      collection : @collection\r\n      region : \"main\"\r\n\r\n    do @collection.fetch\r\n\r\n  show : (params) ->\r\n    @model = new Shot\r\n      \"_id\" : params.id\r\n\r\n    @view = new ShotView\r\n      model : @model\r\n      region : \"main\"\r\n\r\n    @model.fetch().then =>\r\n      do @view.render\r\n","SiteView  = require \"views/site/siteView\"\r\nAboutView = require \"views/about/aboutView\"\r\n\r\nBaseController = require \"controllers/base/baseController\"\r\n\r\nmodule.exports = class StaticController extends BaseController\r\n  beforeAction: ->\r\n    super\r\n\r\n  about: (params) ->\r\n    @view = new AboutView\r\n      autoRender : true\r\n      region : \"main\"\r\n","SiteView = require \"views/site/siteView\"\r\nStation = require \"/models/station\"\r\n\r\n\r\nStationCollection = require \"/collections/stationCollection\"\r\nStationListView   = require \"/views/station/list/stationListView\"\r\n\r\nStationEditView = require \"/views/station/edit/stationEditView\"\r\nStationView     = require \"/views/station/show/stationView\"\r\n\r\nBaseController = require \"controllers/base/baseController\"\r\n\r\nmodule.exports = class StationsController extends BaseController\r\n  beforeAction: ->\r\n    super\r\n\r\n  # Index action. Will just display a list of users.\r\n  index: (params) ->\r\n    @collection = new StationCollection\r\n    @view = new StationListView\r\n      collection : @collection\r\n      region : \"main\"\r\n\r\n    @collection.fetch().then =>\r\n      do @view.render\r\n\r\n  show : (params) ->\r\n    @model = new Station\r\n      name : params.name\r\n\r\n    @view = new StationView\r\n      model : @model\r\n      region : \"main\"\r\n\r\n    @model.fetch().then =>\r\n      do @view.render\r\n\r\n\r\n\r\n\r\n\r\n","require \"utils/analytics/yandexMetrika\"\r\nApplication = require \"application\"\r\n\r\n\r\n###\r\n Application's initialization routine\r\n###\r\n$ ->\r\n  # Initialize new Chaplin application.\r\n  # Specify controller suffix for clarity.\r\n  new Application\r\n    controllerSuffix: 'Controller'\r\n    pushState: true\r\n    routes: require \"routes\"\r\n\r\n  $(window).resize (e) ->\r\n    Chaplin.mediator.publish 'window-resized', $(window).width(), $(window).height()\r\n\r\n\r\n","module.exports = class Shot extends Chaplin.Model\r\n  \r\n  idAttribute : \"_id\"\r\n\r\n  urlRoot : \"/api/shots\"\r\n\r\n  print : ->\r\n    $.get(\"#{@url()}/queue\")\r\n    .done =>\r\n      @.set \"status\", \"queued\"\r\n","\r\nmodule.exports = class Station extends Chaplin.Model\r\n  idAttribute: \"name\"\r\n  \r\n  urlRoot : \"/api/stations\"\r\n\r\n  rename: (name, cb) -> \r\n    $.post \"#{do @url}/rename\", { name : name}, =>\r\n      @set \"name\", name\r\n      do cb\r\n\r\n  secret: (cb) ->\r\n    $.get \"#{do @url}/secret\", (data) =>\r\n      cb data.secret\r\n\r\n\r\n\r\n\r\n  \r\n","\r\nmodule.exports = (match) ->\r\n  match \"stations\", \"stations#index\"\r\n\r\n  match \"stations/create\",\r\n    controller : \"auth/stationAuth\"\r\n    action : \"create\"\r\n    name : \"station_create\"\r\n\r\n  match \"stations/:name\", \"stations#show\"\r\n\r\n  match \"stations/:name/edit\",\r\n    controller : \"auth/stationAuth\"\r\n    action : \"edit\"\r\n    name : \"station_edit\"\r\n\r\n  match \"stations/:name/rename\",\r\n    controller : \"auth/stationAuth\"\r\n    action : \"rename\"\r\n    name : \"station_rename\"\r\n\r\n  match \"auth/login\",\r\n    controller : \"auth/login\"\r\n    action : \"login\"\r\n    name : \"auth_login\"\r\n\r\n  match \"auth/logout\",\r\n    controller : \"auth/login\"\r\n    action : \"logout\"\r\n    name : \"auth_logout\"\r\n\r\n  match \"shots\",        \"shots#index\"\r\n  match \"shots/:id\",    \"shots#show\"\r\n  match \"\",             \"static#about\"\r\n\r\n","module.exports = class Storage \r\n  \r\n","(function (d, w, c) {\r\n    (w[c] = w[c] || []).push(function() {\r\n        try {\r\n          w.yaCounter24199384 = new Ya.Metrika({\r\n            id: 24199384,\r\n            clickmap: true,\r\n            trackLinks: true,\r\n            accurateTrackBounce: true,\r\n            trackHash: true\r\n          });\r\n        } catch(e) { }\r\n    });\r\n\r\n    var n = d.getElementsByTagName(\"script\")[0],\r\n        s = d.createElement(\"script\"),\r\n        f = function () { n.parentNode.insertBefore(s, n); };\r\n    s.type = \"text/javascript\";\r\n    s.async = true;\r\n    s.src = (d.location.protocol == \"https:\" ? \"https:\" : \"http:\") + \"//mc.yandex.ru/metrika/watch.js\";\r\n\r\n    if (w.opera == \"[object Opera]\") {\r\n        d.addEventListener(\"DOMContentLoaded\", f, false);\r\n    } else { f(); }\r\n})(document, window, \"yandex_metrika_callbacks\");\r\n","View = require \"views/base/base\"\r\n\r\nmodule.exports = class AboutView extends View\r\n  _.extend @prototype, Chaplin.EventBroker\r\n\r\n  initialize : ->\r\n    @subscribeEvent 'window-resized', @onResize\r\n    super\r\n\r\n  dispose : ->\r\n    do @turnSlideshowOff\r\n    super\r\n\r\n  ###\r\n  # Slideshow-related methods\r\n  ###\r\n  numberOfSlides : 5\r\n  slideshowInterval : 5000\r\n  slideshowStopped : false\r\n\r\n  slideshowHandler : ->\r\n    unless @currentSlide\r\n      @currentSlide = _.sample _.range(1, @numberOfSlides + 1)\r\n    else\r\n      @currentSlide = (@currentSlide + 1) % @numberOfSlides + 1\r\n\r\n    prevSlide = @$('.slide.active')\r\n    nextSlide = @$('.slide:not(.active)')\r\n\r\n    imageUrl = \"/images/slideshow/landing-bg-#{@currentSlide}.png\"\r\n\r\n    nextSlide.css\r\n      'background-image' : \"url('#{imageUrl}')\"\r\n\r\n    self = @\r\n    $('<img/>').attr('src', imageUrl).load ->\r\n      $(@).remove()\r\n\r\n      prevSlide.removeClass 'active'\r\n      nextSlide.addClass 'active'\r\n\r\n      unless self.slideshowStopped\r\n        self.timeoutHandle = setTimeout _.bind(self.slideshowHandler, self), self.slideshowInterval\r\n\r\n  turnSlideshowOff : ->\r\n    if @timeoutHandle\r\n      clearTimeout @timeoutHandle\r\n      @intervalHandle = null\r\n    @slideshowStopped = true\r\n\r\n  turnSlideshowOn : ->\r\n    do @turnSlideshowOff\r\n    @slideshowStopped = false\r\n    do @slideshowHandler\r\n\r\n  ###\r\n  # Resize and render\r\n  ###\r\n  onResize : (w, h) ->\r\n    @$('.full-height').height(h)\r\n\r\n  render : ->\r\n    super\r\n    do @turnSlideshowOn\r\n    @$('.full-height').height( $(window).height() )\r\n\r\n  template : require \"./aboutView_\"\r\n\r\n  getTemplateData : ->\r\n","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\n\nbuf.push(\"<div class=\\\"about-view\\\"><div class=\\\"fullpage-layer bottommost\\\"></div><div class=\\\"fullpage-layer slide first active\\\"></div><div class=\\\"fullpage-layer slide second\\\"></div><div class=\\\"fullpage-layer fade-overlay\\\"></div><div class=\\\"landing text-center\\\"><div class=\\\"fake-offset\\\"></div><div class=\\\"full-height centered-container\\\"><div class=\\\"centered container\\\"><h1 class=\\\"big-header\\\">Снимайте,\\nпечатайте,<br/>делитесь!</h1><div class=\\\"row\\\"><div class=\\\"col-md-1\\\"></div><div class=\\\"col-md-10\\\"><div class=\\\"big-header-subtitle\\\">Представляем независимый проект по печати фотографий из Instagram\\n&mdash; <b>StevieWhale</b></div><a\" + (jade.attr(\"href\", \"\" + (jade.url('shots#index')) + \"\", true, false)) + \" class=\\\"wow-button btn btn-lg\\\">Ух ты, как интересно!</a></div><div class=\\\"col-md-1\\\"></div></div></div></div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","View = require \"views/base/base\"\r\n\r\nStorage = require \"storage\"\r\n\r\nmodule.exports = class LoginView extends View\r\n  initialize : ->\r\n    @delegate \"submit\", \".login-form\", @login\r\n\r\n  loginSuccess : (user) ->\r\n    Storage.user = user\r\n    Chaplin.mediator.publish 'loginState', user\r\n    if Storage.redirectUrl?\r\n      Chaplin.utils.redirectTo\r\n        url : Storage.redirectUrl\r\n    else\r\n      Chaplin.utils.redirectTo \"static#about\"\r\n\r\n  login : (evt) ->\r\n    evt.preventDefault()\r\n\r\n    data =\r\n      username : @$(\".login-field\").val()\r\n      password : @$(\".password-field\").val()\r\n\r\n    $.post('/api/auth/login', data)\r\n    .done (data) =>\r\n      @loginSuccess data.user\r\n    .fail =>\r\n      @$(\".login-form\").addClass(\"animated shake\")\r\n      @$(\".login-form input\").prop(\"disabled\", true)\r\n      setTimeout =>\r\n        @$(\".login-form\").removeClass(\"animated shake\")\r\n        @$(\".login-form input\").prop(\"disabled\", false)\r\n      , 1000\r\n\r\n\r\n  template : require \"./loginView_\"\r\n\r\n  getTemplateData : ->\r\n","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\n\nbuf.push(\"<form role=\\\"form\\\" class=\\\"text-center login-form\\\"><h2>Вумпс! Авторизуйтесь</h2><div class=\\\"logo-container\\\"><img src=\\\"/images/stevie-kid.svg\\\" class=\\\"img-responsive\\\"/></div><form action=\\\"javascript:void(0)\\\"><div class=\\\"form-group form-group-lg\\\"><input type=\\\"text\\\" placeholder=\\\"Логин\\\" class=\\\"login-field form-control\\\"/><input type=\\\"password\\\" placeholder=\\\"Пароль\\\" class=\\\"password-field form-control\\\"/></div><button type=\\\"submit\\\" class=\\\"login-button btn btn-lg btn-success btn-block\\\">Войти</button></form></form>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","jade.url = Chaplin.utils.reverse\r\n\r\njade.markdown = do ->\r\n  converter = new Showdown.converter()\r\n  (text) =>\r\n    converter.makeHtml text if text?\r\n\r\nStorage = require \"storage\"\r\njade.auth = ->\r\n  Storage.user?\r\n\r\n\r\n \r\n# Base view.\r\nmodule.exports = class View extends Chaplin.View\r\n  # Precompiled templates function initializer.\r\n  getTemplateFunction: ->\r\n    @template\r\n","View = require './base'\r\n\r\nmodule.exports = class CollectionView extends Chaplin.CollectionView\r\n  # This class doesn’t inherit from the application-specific View class,\r\n  # so we need to borrow the method from the View prototype:\r\n  getTemplateFunction: View::getTemplateFunction\r\n","View    = require \"views/base/base\"\r\nStorage = require \"storage\"\r\nShot    = require \"models/shot\"\r\n\r\n\r\nmodule.exports = class ShotGridItemView extends View\r\n  className: \"shot-grid-item col-lg-3 col-md-3 col-sm-4 col-xs-6\"\r\n\r\n  initialize: ->\r\n    super\r\n    @delegate \"click\", \".delete-confirm\", @deleteHandler\r\n    @delegate \"click\", \".print-button\",   @printHandler\r\n\r\n  deleteHandler : ->\r\n    @model.destroy\r\n      wait : true\r\n\r\n  printHandler: ->\r\n    do @model.print\r\n\r\n  template : require \"./shotGridItemView_\"\r\n\r\n  getTemplateData : ->\r\n    shot : @model.attributes\r\n","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar locals_ = (locals || {}),shot = locals_.shot;\nbuf.push(\"<div class=\\\"polaroid\\\"><a\" + (jade.attr(\"href\", jade.url('shots#show', {id : shot._id}), true, false)) + \"><img\" + (jade.attr(\"src\", \"\" + (shot.thumbnail) + \"\", true, false)) + \" class=\\\"polaroid-photo img-responsive\\\"/><div class=\\\"photo-user\\\"><div class=\\\"media\\\"><a\" + (jade.attr(\"href\", \"http://instagram.com/\" + shot.instagram.user.username, true, false)) + \" target=\\\"_blank\\\" class=\\\"pull-left\\\"><img\" + (jade.attr(\"src\", shot.instagram.user.profile_picture, true, false)) + \" width=\\\"48\\\" height=\\\"48\\\" class=\\\"img-circle media-object\\\"/></a><div class=\\\"media-body\\\"><a\" + (jade.attr(\"href\", \"http://instagram.com/\" + shot.instagram.user.username, true, false)) + \" target=\\\"_blank\\\"><h4 class=\\\"media-heading\\\">@\" + (jade.escape(null == (jade.interp = shot.instagram.user.username) ? \"\" : jade.interp)) + \"<small> (\" + (jade.escape(null == (jade.interp = shot.instagram.user.full_name) ? \"\" : jade.interp)) + \")</small></h4></a>\" + (jade.escape(null == (jade.interp = shot.instagram.caption.text) ? \"\" : jade.interp)) + \"</div></div></div></a></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","ShotGridItemView = require \"./item/shotGridItemView\"\r\nCollectionView   = require \"views/base/collectionView\"\r\n\r\n\r\nmodule.exports = class ShotGridView extends CollectionView\r\n  animationDuration : 300\r\n  initialize : ->\r\n    super\r\n    @delegate \"click\", \".load-button\", =>\r\n      # Disable this feature\r\n      # do @collection.forceLoad\r\n\r\n  className : \"shot-grid-view\"\r\n\r\n  listSelector : \".shot-grid\"\r\n\r\n  itemView : ShotGridItemView\r\n\r\n  template : require \"./shotGridView_\"\r\n\r\n","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\n\nbuf.push(\"<div class=\\\"shot-grid-view\\\"><div class=\\\"container\\\"><div class=\\\"shot-grid\\\"></div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","View = require \"views/base/base\"\r\n\r\nmodule.exports = class ShotView extends View\r\n  template : require \"./shotView_\"\r\n\r\n  getTemplateData : ->\r\n    shot : @model.attributes\r\n","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar locals_ = (locals || {}),shot = locals_.shot;\nbuf.push(\"<div class=\\\"container\\\"><div class=\\\"row shot-single-view\\\"><div class=\\\"col-lg-4 col-md-5 col-xs-8\\\"><div class=\\\"shot-grid-item\\\"><div class=\\\"polaroid\\\"><a\" + (jade.attr(\"href\", shot.instagram.link, true, false)) + \" target=\\\"_blank\\\"><img\" + (jade.attr(\"src\", \"\" + (shot.image) + \"\", true, false)) + \" class=\\\"polaroid-photo img-responsive\\\"/></a><div class=\\\"photo-user\\\"><div class=\\\"media\\\"><a\" + (jade.attr(\"href\", \"http://instagram.com/\" + shot.instagram.user.username, true, false)) + \" target=\\\"_blank\\\" class=\\\"pull-left\\\"><img\" + (jade.attr(\"src\", shot.instagram.user.profile_picture, true, false)) + \" width=\\\"48\\\" height=\\\"48\\\" class=\\\"img-circle media-object\\\"/></a><div class=\\\"media-body\\\"><a\" + (jade.attr(\"href\", \"http://instagram.com/\" + shot.instagram.user.username, true, false)) + \" target=\\\"_blank\\\"><h4 class=\\\"media-heading\\\">@\" + (jade.escape(null == (jade.interp = shot.instagram.user.username) ? \"\" : jade.interp)) + \"<small> (\" + (jade.escape(null == (jade.interp = shot.instagram.user.full_name) ? \"\" : jade.interp)) + \")</small></h4></a>\" + (jade.escape(null == (jade.interp = shot.instagram.caption.text) ? \"\" : jade.interp)) + \"</div></div></div></div></div></div><div class=\\\"col-lg-8 col-md-7 col-xs-12\\\">\");\nswitch (shot.status){\ncase \"printed\":\nbuf.push(\"<h3>Как забрать фотографию со станции &laquo;<a\" + (jade.attr(\"href\", jade.url('stations#show', { name : shot.printedOn.name}), true, false)) + \">\" + (jade.escape(null == (jade.interp = shot.printedOn.title) ? \"\" : jade.interp)) + \"</a>&raquo;?</h3><div class=\\\"markdown\\\">\" + (null == (jade.interp = jade.markdown(shot.printedOn.instructions)) ? \"\" : jade.interp) + \"</div>\");\n  break;\ndefault:\nbuf.push(\"<h3>Фотография еще не была напечатана</h3>\");\n  break;\n}\nbuf.push(\"</div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","View = require 'views/base/base'\r\n\r\n# Site view is a top-level view which is bound to body.\r\nmodule.exports = class HeaderView extends View\r\n  template: require './headerView_'\r\n\r\n  className : 'header-view-container'\r\n\r\n  initialize : ->\r\n    Chaplin.mediator.subscribe 'dispatcher:dispatch', @onDispatch\r\n    Chaplin.mediator.subscribe 'loginState', @onLoginChanged\r\n\r\n    @delegate 'click', 'li a', =>\r\n      @$('.navbar-collapse').collapse('hide')\r\n      \r\n    super\r\n\r\n  onLoginChanged : (user) =>\r\n    do @render\r\n\r\n  onDispatch : (currentController, params, route, options) =>\r\n    # # Make active navigation links\r\n    action = route.controller.split('/')[0]\r\n    @$('.site-navigation li.selected').removeClass('selected')\r\n    @$(\".site-navigation li.nav-#{action}\").addClass('selected')\r\n\r\n    if action is 'static'\r\n      @$el.addClass('static-page')\r\n    else\r\n      @$el.removeClass('static-page')\r\n\r\n","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\n\nbuf.push(\"<nav class=\\\"site-navigation navbar navbar-static-top\\\"><div class=\\\"container\\\"><div class=\\\"navbar-header\\\"><button data-toggle=\\\"collapse\\\" data-target=\\\"#navbar-collapsing-menu\\\" class=\\\"navbar-toggle\\\"><span class=\\\"navicon ion-navicon-round\\\"></span><span class=\\\"sr-only\\\">Toggle navigation</span></button></div><div id=\\\"navbar-collapsing-menu\\\" class=\\\"collapse navbar-collapse\\\"><ul class=\\\"nav navbar-nav navbar-left\\\"><li class=\\\"nav-static\\\"><a\" + (jade.attr(\"href\", jade.url(\"static#about\"), true, false)) + \"> О проекте</a></li><li class=\\\"nav-stations\\\"><a\" + (jade.attr(\"href\", \"\" + (jade.url('stations#index')) + \"\", true, false)) + \"> Печатные станции</a></li><li class=\\\"nav-shots\\\"><a\" + (jade.attr(\"href\", \"\" + (jade.url('shots#index')) + \"\", true, false)) + \"> Фотографии</a></li></ul><ul class=\\\"nav navbar-nav navbar-right\\\">\");\nif ( !jade.auth())\n{\nbuf.push(\"<li><a data-toggle=\\\"collapse\\\" data-target=\\\"#navbar-collapse-toggle\\\"\" + (jade.attr(\"href\", \"\" + (jade.url('auth_login')) + \"\", true, false)) + \"> войти</a></li>\");\n}\nelse\n{\nbuf.push(\"<li><a\" + (jade.attr(\"href\", \"\" + (jade.url('auth_logout')) + \"\", true, false)) + \"> выйти</a></li>\");\n}\nbuf.push(\"</ul></div></div></nav>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","View = require 'views/base/base'\r\n\r\n# Site view is a top-level view which is bound to body.\r\nmodule.exports = class SiteView extends View\r\n  container: 'body'\r\n\r\n  id: 'site-container'\r\n\r\n  regions:\r\n    main:   '#main-container'\r\n    header: '#header-container'\r\n\r\n  template: require './siteView_'\r\n","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\n\nbuf.push(\"<div id=\\\"header-container\\\"></div><div class=\\\"container-fluid site-container\\\"><div id=\\\"main-container\\\"></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","View = require \"views/base/base\"\r\n\r\nStation           = require \"models/station\"\r\nStationCollection = require \"collections/stationCollection\"\r\n\r\nmodule.exports = class StationCreateView extends View\r\n  initialize : ->\r\n    @delegate \"click\", \".register-button\", @register\r\n\r\n  register : ->\r\n    fields = \r\n      title : @$(\".title-input\").val()\r\n      subtitle : @$(\".subtitle-input\").val()\r\n\r\n    station = new Station fields\r\n\r\n    station.save null,\r\n      success : ->\r\n        Chaplin.utils.redirectTo(\"stations#index\")\r\n\r\n\r\n\r\n  template : require \"./stationCreateView_\"\r\n\r\n  getTemplateData : ->\r\n","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\n\nbuf.push(\"<div class=\\\"container\\\"><h1>Регистрация станции</h1><div role=\\\"form\\\" class=\\\"form\\\"><div class=\\\"form-group\\\"><input type=\\\"text\\\" placeholder=\\\"Название\\\" class=\\\"title-input form-control\\\"/></div><div class=\\\"form-group\\\"><input type=\\\"text\\\" placeholder=\\\"Подзаголовок\\\" class=\\\"subtitle-input form-control\\\"/></div><div class=\\\"row\\\"><div class=\\\"col-md-4 col-md-offset-4\\\"><div class=\\\"register-button btn btn-primary btn-lg btn-block save-button\\\">Зарегистрировать</div></div></div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","View    = require \"views/base/base\"\r\nStation = require \"models/station\"\r\n\r\nmodule.exports = class StationEditView extends View\r\n  model : Station\r\n\r\n  template : require \"./stationEditView_\"\r\n\r\n  initialize : ->\r\n    @delegate 'click', '.save-button', @save\r\n\r\n  save : ->\r\n    fields =\r\n      title       : @$(\".title-input\").val()\r\n      subtitle    : @$(\".subtitle-input\").val()\r\n      description : @$(\".desc-input\").val()\r\n      instructions: @$(\".instructions-input\").val()\r\n\r\n    @model.save fields,\r\n      success : =>\r\n        Chaplin.utils.redirectTo \"stations#show\",\r\n          name : @model.attributes.name\r\n\r\n  getTemplateData : ->\r\n    station : @model.attributes\r\n","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar locals_ = (locals || {}),station = locals_.station;\nbuf.push(\"<div class=\\\"container\\\"><h1>Редактировать станцию</h1><div role=\\\"form\\\" class=\\\"form\\\">   <div class=\\\"form-group\\\"><label>Название</label><input type=\\\"text\\\"\" + (jade.attr(\"value\", station.title, true, false)) + \" class=\\\"title-input form-control\\\"/></div><div class=\\\"form-group\\\"><label>Подзаголовок</label><input type=\\\"text\\\"\" + (jade.attr(\"value\", station.subtitle, true, false)) + \" class=\\\"subtitle-input form-control\\\"/></div><div class=\\\"form-group\\\"><label>Как забрать фотографию? <small>(Поддерживает Markdown)</small></label><textarea rows=\\\"6\\\"\" + (jade.attr(\"text\", station.description, true, false)) + \" class=\\\"instructions-input form-control\\\">\" + (jade.escape(null == (jade.interp = station.instructions) ? \"\" : jade.interp)) + \"</textarea></div><div class=\\\"form-group\\\"><label>Описание <small>(Поддерживает Markdown)</small></label><textarea rows=\\\"12\\\"\" + (jade.attr(\"text\", station.description, true, false)) + \" class=\\\"desc-input form-control\\\">\" + (jade.escape(null == (jade.interp = station.description) ? \"\" : jade.interp)) + \"</textarea></div><div class=\\\"row\\\"><div class=\\\"col-md-4 col-md-offset-4\\\"><div class=\\\"login-button btn btn-primary btn-lg btn-block save-button\\\">Сохранить</div></div></div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","View = require \"views/base/base\"\r\nStorage = require \"storage\"\r\n\r\nmodule.exports = class StationListItemView extends View\r\n  template : require \"./stationListItemView_\"\r\n\r\n  getTemplateData : ->\r\n    station : @model.attributes\r\n","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar locals_ = (locals || {}),station = locals_.station;\nbuf.push(\"<div class=\\\"station-item\\\"><h3><a\" + (jade.attr(\"href\", jade.url('stations#show', { name : station.name }), true, false)) + \">\" + (jade.escape(null == (jade.interp = station.title ) ? \"\" : jade.interp)) + \"</a> \");\nswitch (station.online){\ncase true :\nbuf.push(\"<span class=\\\"label label-success\\\">Онлайн</span>\");\n  break;\ndefault:\nbuf.push(\"<span class=\\\"label label-warning\\\">Оффлайн</span>\");\n  break;\n}\nbuf.push(\"</h3><p class=\\\"lead\\\">\" + (jade.escape(null == (jade.interp = station.subtitle) ? \"\" : jade.interp)) + \"</p></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","StationListItemView = require \"./stationListItemView\"\r\n\r\nmodule.exports = class StationListView extends Chaplin.CollectionView\r\n  animationDuration : 300\r\n  itemView : StationListItemView\r\n\r\n  listSelector : \".station-list\"\r\n\r\n  loadingSelector : \".loading-container\"\r\n\r\n  template : require \"./stationListView_\"\r\n\r\n\r\n  getTemplateData : ->\r\n  getTemplateFunction: ->\r\n    @template\r\n","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\n\nbuf.push(\"<div class=\\\"container navbar-shift\\\"><div class=\\\"row\\\"><div class=\\\"col-md-12\\\">\");\nif ( jade.auth())\n{\nbuf.push(\"<a\" + (jade.attr(\"href\", jade.url(\"station_create\"), true, false)) + \" class=\\\"btn btn-success\\\"><i class=\\\"fa fa-plus\\\"></i> Зарегистрировать</a>\");\n}\nbuf.push(\"<div class=\\\"loading-container\\\"><h2>Загрузка</h2></div><div class=\\\"station-list\\\"></div></div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","View = require \"views/base/base\"\r\n\r\nStation           = require \"models/station\"\r\nStationCollection = require \"collections/stationCollection\"\r\n\r\nmodule.exports = class StationRenameView extends View\r\n  initialize : ->\r\n    @delegate \"click\", \".rename-button\", @rename\r\n    @delegate \"click\", \".cancel-button\", @cancel\r\n\r\n  rename : ->\r\n    nameValue = $(\".name-input\").val()\r\n\r\n    @model.rename nameValue, (err) =>\r\n      do @cancel\r\n      \r\n  cancel : ->\r\n    Chaplin.utils.redirectTo \"stations#show\", \r\n      name : @model.get \"name\"\r\n\r\n\r\n\r\n  template : require \"./stationRenameView_\"\r\n\r\n  getTemplateData : ->\r\n    station : @model.attributes\r\n","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar locals_ = (locals || {}),station = locals_.station;\nbuf.push(\"<div class=\\\"container\\\"><div class=\\\"row text-center\\\"><h1>Сменить URL станции</h1><div class=\\\"col-md-4 col-md-offset-4\\\"><div role=\\\"form\\\" class=\\\"form\\\"><div class=\\\"form-group\\\"><input type=\\\"text\\\"\" + (jade.attr(\"value\", station.name, true, false)) + \" placeholder=\\\"Название\\\" class=\\\"name-input form-control\\\"/></div><div class=\\\"form-group\\\"><div class=\\\"rename-button btn btn-success btn-block btn-lg\\\">Поменять</div><div class=\\\"cancel-button btn btn-default btn-block btn-lg\\\">Отмена</div></div></div></div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","View    = require \"views/base/base\"\r\nStation = require \"models/station\"\r\n\r\nmodule.exports = class StationView extends View\r\n  model : Station\r\n\r\n  initialize : ->\r\n    @delegate \"click\", \".delete-confirm-button\", @deleteStation\r\n    @delegate \"click\", \".secret-button\", @showSecret\r\n  \r\n  deleteStation : ->\r\n    @$(\".delete-modal\").modal(\"hide\")\r\n    @model.destroy\r\n      success : =>\r\n        Chaplin.utils.redirectTo \"stations#index\"\r\n\r\n  showSecret : ->\r\n    @model.secret (secret) => \r\n      @$(\".secret-modal .secret-field\").text(secret)\r\n      @$(\".secret-modal\").modal(\"show\")\r\n\r\n\r\n  template : require \"./stationView_\"\r\n\r\n  render : ->\r\n    super\r\n    canvas = @$(\".video-canvas\")[0]\r\n    ctx = canvas.getContext '2d'\r\n\r\n    streamingText = \"Прямой эфир выключен\"\r\n    if @model.get \"streaming\"\r\n      streamingText = \"Живая трансляция станции\"\r\n\r\n    @$('.tooltip-button').tooltip\r\n      placement : 'top'\r\n      title : streamingText\r\n\r\n    if @model.get \"streaming\"\r\n      wsAddress = \"ws://#{window.location.hostname}:3030/#{@model.attributes.name}\"\r\n\r\n      @client = new WebSocket( wsAddress )\r\n      @player = new jsmpeg @client, \r\n        canvas : canvas\r\n\r\n  getTemplateData : ->\r\n    station : @model.attributes\r\n","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar locals_ = (locals || {}),station = locals_.station;\nbuf.push(\"<div class=\\\"container\\\"><div class=\\\"station-item\\\"><h1>\" + (jade.escape(null == (jade.interp = station.title ) ? \"\" : jade.interp)) + \"&nbsp;\");\nswitch (station.online){\ncase true :\nbuf.push(\"<span class=\\\"label label-success\\\">Онлайн</span>\");\n  break;\ndefault:\nbuf.push(\"<span class=\\\"label label-warning\\\">Оффлайн</span>\");\n  break;\n}\nbuf.push(\"<h2>\");\nif ( jade.auth())\n{\nbuf.push(\"<div class=\\\"btn-group btn-group-sm\\\"><button type=\\\"button\\\" data-toggle=\\\"dropdown\\\" class=\\\"btn btn-default dropdown-toggle\\\"><i class=\\\"fa fa-gear\\\"></i> <span class=\\\"caret\\\"></span></button><ul role=\\\"menu\\\" class=\\\"dropdown-menu\\\"><li><a\" + (jade.attr(\"href\", jade.url('station_edit', {name : station.name}), true, false)) + \" class=\\\"edit-button\\\"><i class=\\\"fa fa-edit\\\"></i> Редактировать</a></li><li><a\" + (jade.attr(\"href\", jade.url('station_rename', {name : station.name}), true, false)) + \" class=\\\"edit-button\\\"><i class=\\\"fa fa-cloud\\\"></i> Сменить URL</a></li><li><a href=\\\"#\\\" class=\\\"secret-button\\\"><i class=\\\"fa fa-asterisk\\\"></i> Показать пароль</a></li><li><a href=\\\"#\\\" data-toggle=\\\"modal\\\" data-target=\\\".delete-modal\\\" class=\\\"delete-button\\\"><i class=\\\"fa fa-trash-o\\\"></i> Удалить</a></li></ul></div>\");\n}\nbuf.push(\"        <small>\" + (jade.escape(null == (jade.interp = station.subtitle) ? \"\" : jade.interp)) + \"</small></h2></h1><div class=\\\"station-info row\\\"><div class=\\\"video-streaming col-md-4\\\"><canvas width=\\\"240\\\" height=\\\"240\\\" data-toggle=\\\"tooltip\\\" class=\\\"video-canvas tooltip-button\\\"></canvas></div><div class=\\\"station-title col-md-8\\\"><h3>Как забирать фотографии с этой станции?</h3><div class=\\\"markdown\\\">\" + (null == (jade.interp = jade.markdown(station.instructions)) ? \"\" : jade.interp) + \"</div></div></div><div class=\\\"markdown\\\">\" + (null == (jade.interp = jade.markdown(station.description)) ? \"\" : jade.interp) + \"</div></div><div tabindex=\\\"-1\\\" role=\\\"dialog\\\" aria-labelledby=\\\"mySmallModalLabel\\\" aria-hidden=\\\"true\\\" class=\\\"modal delete-modal\\\"><div class=\\\"modal-dialog modal-sm\\\"><div class=\\\"modal-content\\\"><div class=\\\"modal-header\\\"><h4 class=\\\"modal-title\\\">Удалить станцию?</h4></div><div class=\\\"modal-body\\\">Внимательно подумайте перед удалением станции, возможно, она вам \\nеще пригодится! </div><div class=\\\"modal-footer text-center\\\"><button class=\\\"delete-confirm-button btn btn-primary\\\">Да!</button><button data-dismiss=\\\"modal\\\" class=\\\"btn btn-default\\\">Нет, я передумал.</button></div></div></div></div><div class=\\\"modal secret-modal\\\"><div class=\\\"modal-dialog modal-sm\\\"><div class=\\\"modal-content\\\"><div class=\\\"modal-header\\\"><h4 class=\\\"modal-title\\\">Пароль станции</h4></div><div class=\\\"modal-body text-center\\\"><p>Используйте этот пароль для подключения агента печатной станции:</p><h2 class=\\\"secret-field\\\"></h2></div><div class=\\\"modal-footer text-center\\\"><button data-dismiss=\\\"modal\\\" class=\\\"btn btn-success\\\">ОК</button></div></div></div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}"]}